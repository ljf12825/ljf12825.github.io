---
title: Design Pattern
author: ljf12825
date: 2025-12-31
type: file
summary: overview and limitations of design pattern
---

设计模式是软件工程中针对常见设计问题总结出的可复用解决方案模板，本质上是一种经验级的代码结构指导思想，而不是具体的代码实现

最经典的设计模式体系来自*Design Patterns: Elements of Reusable Object-Oriented Software（通常被称为GoF设计模式）*，由四位作者总结了面向对象软件开发中的23种模式

## 设计模式解决的问题

设计模式主要解决三类软件设计问题

### 代码耦合问题

例如：

- 模块之间依赖过强
- 修改一个地方导致多处崩溃

常见手段：接口抽象、依赖反转

### 可扩展性问题

例如：

- 新增功能时不想改旧代码

常见手段：组合优于继承、策略化行为

### 代码复用与结构规范

例如：

- 如何组织对象生命周期
- 如何统一创建对象

## 设计模式的本质思想

可以把设计模式理解为三层东西

| 层级 | 内容 |
| - | - |
| 哲学层 | 面向接口编程、低耦合、高内聚 |
| 结构层 | 对象关系组织方式 |
| 实现层 | 具体代码模板 |

核心原则通常围绕

- 开闭原则（OCP）：对扩展开放，对修改关闭
- 单一职责原则（SRP）
- 依赖倒置原则（DIP）

这些属于面向对象设计的基础理论

## 误区

设计模式不是必须使用的

很容易出现

- 过度工程（over-engineering）
- 为了模式而模式

真正成熟的工程实践是：当问题出现时，再选择合适模式，而不是提前设计模式

> 设计模式是软件工程中常见问题的抽象化工程套路，而不是代码规则

## Addtional

很多底层/高性能代码会弱化传统面向对象模式，相比之下，更需要理解的是

- 组件化架构思想
- 数据驱动设计（Data-Oriented Design）
- 接口隔离与依赖管理
- 生命周期控制

这并不是反对设计模式，而是反对“模式中心主义”

核心原因：性能与复杂度优先级更高

传统设计模式通常隐含几个假设

- 运行时抽象
- 对象多态调度
- 间接层封装

但在高性能系统中，这些可能是负担

### 虚函数调用可能成为性能瓶颈

比如：大量对象走虚表调度，CPU pipeline预测失败，Cache locality下降\
在游戏引擎和图形计算中，这些成本非常真实\
所以很多引擎更倾向

- 模板静态多态
- 编译期绑定
- 数据驱动结构

而不是过度面向对象继承体系

### 过度抽象会增加认知成本

设计模式本质上是用抽象换扩展性，但问题是：抽象层越多，系统越难维护\
特别是中小规模系统，团队成员水平差异大\
高水平工程实践更追求：直接、透明、可推理的代码路径

---

现代引擎正在从OOP Class Hierarchy Driven转向 Data-Oriented Design(DOD)

核心理念是

- 以数据布局为第一设计目标
- 尽量减少运行时多态
- 提高cache hit rate

因为现代CPU性能瓶颈主要在

- 内存访问延迟
- Cache miss

而不是算法复杂度本身

---

## 正确的设计方式

- 先确定数据结构

先想：

- 数据在哪里
- 如何连续存储
- 生命周期如何管理

而不是先想类结构

- 再考虑计算路径

思考：

- 是否能批处理
- 是否能SIMD化
- 是否能避免分支预测失败

- 最后才考虑抽象接口

而不是先写一堆interface和pattern