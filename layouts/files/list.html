{{ define "head_extra" }}
  <link rel="stylesheet" href="{{ "css/doc-browser.css" | relURL }}">
{{ end }}

{{ define "main" }}
<div class="doc-browser github-style">
  <!-- 增强的标题和路径区域 -->
  <div class="doc-browser-header">
    <div class="path-header">
      <div class="repo-info">
        <svg class="octicon octicon-repo" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true">
          <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
        </svg>
        <span class="repo-name">文档库</span>
        <span class="repo-slash">/</span>
      </div>
      
      <!-- 动态路径面包屑 -->
      <nav class="path-breadcrumb" aria-label="路径导航">
        <ol class="path-breadcrumb-list">
          <!-- 根目录链接 -->
          <li class="path-breadcrumb-item">
            <a href="{{ "/files/" | relURL }}" class="path-breadcrumb-link">
              <span>root</span>
            </a>
            <svg class="breadcrumb-separator" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path fill-rule="evenodd" d="M6.22 3.22a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06L9.94 8 6.22 4.28a.75.75 0 010-1.06z"></path>
            </svg>
          </li>
          
          <!-- 动态生成路径 -->
          {{ $current := . }}
          {{ $ancestors := .Ancestors.Reverse }}
          
          {{ range $index, $page := $ancestors }}
            {{ if and (ne .Kind "home") (ne .Section "") }}
              <li class="path-breadcrumb-item">
                {{ if ne $page $current }}
                  <a href="{{ .RelPermalink }}" class="path-breadcrumb-link">
                    {{ if eq .Section "files" }}
                      <span>{{ .LinkTitle | default "文档" }}</span>
                    {{ else }}
                      <span>{{ .LinkTitle }}</span>
                    {{ end }}
                  </a>
                {{ else }}
                  <span class="path-breadcrumb-link current">
                    <span>{{ .LinkTitle }}</span>
                  </span>
                {{ end }}
                
                <!-- 如果不是最后一项，显示分隔符 -->
                {{ if lt (add $index 1) (len $ancestors) }}
                  <svg class="breadcrumb-separator" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.22 3.22a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06L9.94 8 6.22 4.28a.75.75 0 010-1.06z"></path>
                  </svg>
                {{ end }}
              </li>
            {{ end }}
          {{ end }}
          
          <!-- 当前页面（如果不是目录） -->
          {{ if .IsPage }}
            <li class="path-breadcrumb-item">
              <svg class="breadcrumb-separator" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path fill-rule="evenodd" d="M6.22 3.22a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06L9.94 8 6.22 4.28a.75.75 0 010-1.06z"></path>
              </svg>
              <span class="path-breadcrumb-link current">
                <span>{{ .Title }}</span>
              </span>
            </li>
          {{ end }}
        </ol>
      </nav>
    </div>
    
    <div class="header-actions">
      <div class="current-path-info">
        {{ if .IsPage }}
          <span class="path-indicator">
            <svg class="octicon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path fill-rule="evenodd" d="M3.75 1.5a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 019 4.25V1.5H3.75zm6.75.062V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0113.25 16h-9.5A1.75 1.75 0 012 14.25V1.75z"></path>
            </svg>
            文档文件
          </span>
        {{ else }}
          <span class="path-indicator">
            <svg class="octicon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"></path>
            </svg>
            文件夹
          </span>
        {{ end }}
        <span class="item-count">{{ len .Pages }} 项</span>
      </div>
    </div>
  </div>

  <!-- GitHub风格的文件浏览器 -->
  <div class="file-explorer">
    <!-- 文件浏览器主体 -->
    <div class="file-explorer-main">
      <!-- 左侧文件树 -->
      <div class="file-tree-container">
        <div class="file-tree-header">
          <h3>目录结构</h3>
          <button class="tree-toggle" aria-label="切换文件树" title="折叠/展开目录树">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path fill-rule="evenodd" d="M12.78 6.22a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06 0L3.22 7.28a.75.75 0 011.06-1.06L8 9.94l3.72-3.72a.75.75 0 011.06 0z"></path>
            </svg>
          </button>
        </div>
        <div class="file-tree">
          {{ partial "doc-tree.html" . }}
        </div>
      </div>

      <!-- 右侧文件列表 -->
      <div class="file-list-container">
        <div class="file-list-header">
          <h2>
            {{ if .IsPage }}
              文档: {{ .Title }}
            {{ else }}
              文件夹内容: {{ .Title }}
            {{ end }}
          </h2>
          <div class="file-count">
            {{ if .IsPage }}
              <span>文档详情</span>
            {{ else }}
              <span>{{ len .Pages }} 个项目</span>
            {{ end }}
          </div>
        </div>

        <div class="file-list">
          {{ if .IsPage }}
            <!-- 文档内容区域 -->
            <article class="doc-content-viewer">
              <!-- ... 文档内容部分保持不变 ... -->
            </article>
          {{ else }}
            <!-- 显示README或当前目录的描述 -->
            {{ $readme := where .Pages "File.BaseFileName" "eq" "README" }}
            {{ if $readme }}
              {{ range first 1 $readme }}
              <div class="readme-preview">
                <div class="readme-header">
                  <svg class="octicon text-gray mr-2" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75ZM1.5 1.75a.25.25 0 0 1 .25-.25h12.5a.25.25 0 0 1 .25.25v12.5a.25.25 0 0 1-.25.25H1.75a.25.25 0 0 1-.25-.25V1.75Z"></path>
                    <path fill-rule="evenodd" d="M3 3.75A.75.75 0 0 1 3.75 3h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 3 3.75ZM3 6a.75.75 0 0 1 .75-.75h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 3 6Zm0 2.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 3 8.25Z"></path>
                  </svg>
                  <strong>README.md</strong>
                </div>
                <div class="readme-content">
                  {{ .Content | safeHTML | truncate 300 }}
                  <a href="{{ .RelPermalink }}" class="readme-link">查看完整内容</a>
                </div>
              </div>
              {{ end }}
            {{ end }}

            <!-- 文件夹和文件列表 -->
            <div class="list-container">
              <!-- 先显示子文件夹 -->
              {{ $folders := where .Pages ".IsSection" true }}
              {{ if $folders }}
                <div class="section-header">
                  <h4>文件夹</h4>
                </div>
                {{ range $folders }}
                <a href="{{ .RelPermalink }}" class="file-list-item folder-item">
                  <div class="file-icon">
                    <svg class="octicon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"></path>
                    </svg>
                  </div>
                  <div class="file-name">
                    {{ .Title }}
                    <span class="file-slash">/</span>
                  </div>
                  <div class="file-meta">
                    <span class="folder-stats">
                      <svg class="octicon" width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd" d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"></path>
                      </svg>
                      {{ len .Pages }} 项
                    </span>
                  </div>
                </a>
                {{ end }}
              {{ end }}

              <!-- 再显示文件 -->
              {{ $files := where .Pages ".IsPage" true }}
              {{ $regularFiles := where $files "File.BaseFileName" "!=" "README" }}
              {{ if $regularFiles }}
                <div class="section-header">
                  <h4>文件</h4>
                </div>
                {{ range $regularFiles }}
                <a href="{{ .RelPermalink }}" class="file-list-item file-item">
                  <div class="file-icon">
                    <svg class="octicon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <path fill-rule="evenodd" d="M3.75 1.5a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 019 4.25V1.5H3.75zm6.75.062V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0113.25 16h-9.5A1.75 1.75 0 012 14.25V1.75z"></path>
                    </svg>
                  </div>
                  <div class="file-name">
                    {{ .Title }}
                  </div>
                  <div class="file-meta">
                    <span class="file-date">
                      {{ .Lastmod.Format "2006-01-02" }}
                    </span>
                  </div>
                </a>
                {{ end }}
              {{ end }}
              
              {{ if and (eq (len $folders) 0) (eq (len $regularFiles) 0) }}
                <div class="empty-folder">
                  <svg class="octicon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"></path>
                  </svg>
                  <h4>空文件夹</h4>
                  <p>此文件夹中没有文件或子文件夹</p>
                </div>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 交互脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // 路径面包屑交互
  const pathLinks = document.querySelectorAll('.path-breadcrumb-link');
  pathLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      if (this.classList.contains('current')) {
        e.preventDefault();
      }
    });
  });

  // 文件树交互逻辑保持不变...
  // ... [原有的文件树交互代码]
});
</script>
{{ end }}