{{ define "head_extra" }}
  {{ if eq .Section "blog" }}
    <link rel="stylesheet" href="{{ "css/blog.css" | relURL }}">
  {{ end }}
{{ end }}

{{ define "main" }}
<div class="blog-container">

  <!-- 中间博客内容 -->
  <main class="blog-main">
    <h1 class="page-title">{{ .Title }}</h1>

    <div class="blog-grid">
      {{ range where .Site.RegularPages "Section" "blog" }}
        <a href="{{ .RelPermalink }}" class="blog-card">
          {{ with .Params.featured_image }}
            <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="blog-thumb">
          {{ else }}
            <img src="{{ "images/placeholder.jpg" | relURL }}" alt="{{ $.Title }}" class="blog-thumb">
          {{ end }}

          <div class="blog-content">
            <h2 class="blog-title">{{ .Title }}</h2>

            <div class="blog-meta">
              <span class="date"><b>lastmodify:</b> {{ .Date.Format "2006-01-02" }}</span>
              {{ with .Params.creator }}  <span class="author"><b>creator: </b>{{ . }}</span>{{ end }}
              {{ with .Params.tags }}
                 <span class="tags">#{{ delimit . " #" }}</span>
              {{ end }}
            </div>

            <p class="blog-summary">
              {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary }}{{ end }}
            </p>

            <span class="read-more">阅读全文</span>
          </div>
        </a>
      {{ end }}
    </div>
  </main>

  <!-- 右侧 sidebar -->
  <aside class="sidebar-right">
    <!-- 搜索框 -->
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="搜索文章…">
    </div>

    <!-- 标签集合 -->
    <div class="tags-box">
      <h3>标签</h3>
      <ul id="tagList">
        {{ $allTags := .Site.Taxonomies.tags }}
        {{ range $tag, $pages := $allTags }}
          <li><a href="#" class="tag-link" data-tag="{{ $tag }}">#{{ $tag }}</a></li>
        {{ end }}
      </ul>
    </div>
  </aside>

</div>

<!-- JS: 搜索 & 标签筛选 -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  const searchInput = document.getElementById('searchInput');
  const tagLinks = document.querySelectorAll('.tag-link');
  const cards = document.querySelectorAll('.blog-card');

  // 搜索功能
  searchInput.addEventListener('input', function(){
    const keyword = this.value.toLowerCase();
    cards.forEach(card => {
      const title = card.querySelector('.blog-title').innerText.toLowerCase();
      const summary = card.querySelector('.blog-summary').innerText.toLowerCase();
      card.style.display = (title.includes(keyword) || summary.includes(keyword)) ? '' : 'none';
    });
  });

  // Tag 筛选
  tagLinks.forEach(link => {
    link.addEventListener('click', function(e){
      e.preventDefault();
      const tag = this.dataset.tag;
      cards.forEach(card => {
        const tags = card.querySelector('.tags')?.innerText || '';
        card.style.display = tags.includes(tag) ? '' : 'none';
      });
    });
  });
});
</script>

{{ end }}
