<!doctype html><html lang=en><head><meta name=page-kind content="page"><meta charset=UTF-8><title>add</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-lua.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-rust.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=stylesheet href=/css/logsingle.css></head><body><header class=site-header><div class=container><div class=terminal-overlay aria-label=terminal-prompt><span id=typed-line></span><span class=cursor>█</span></div></div></header><nav class=topnav><div class=container><ul><li><a href=/unixlike/>★</a></li><li><a href=/unixlike/lab/>Lab</a></li><li><a href=/unixlike/log/>Log</a></li><li><a href=/unixlike/file/>File</a></li></ul></div></nav><nav id=star-nav><div id=star-header><span class="title open">>> >> >> Navigation &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Nav>>>>>></span></div><pre class=ascii>
+——————————————————————————————————————————————————————————————+
|                        <a class=nav-item data-path=/rightbrain/ href=/rightbrain/>RightBrain</a>                            |
|                             |                                |
|                             |     <a class=nav-item data-path=/dotnetandwindows/ href=/dotnetandwindows/>.NET-Windows</a>               |
|                             |    /                           |
|                             |   /                            |
|                             |  /                             |
|                             | /                              |
|                             |/                               |
|      <a class=nav-item data-path=/graphic/ href=/graphic/>Graphic</a> ———————————— <a class=nav-item data-path=/home/ href=/home/>Home</a> ————————————— <a class=nav-item data-path=/runtime/ href=/runtime/>Runtime</a>         |
|                            /|                                |
|                           / |                                |
|                          /  |                                |
|                         /   |       <a class=nav-item data-path=/language/ href=/language/>Language</a>                 |
|                        /    |      /                         |
|                       /     |     /                          |
|              <a class=nav-item data-path=/unixlike/ href=/unixlike/>Unix-like</a>      |    /           <a class=nav-item data-path=/project/ href=/project/>Project</a>         |
|                             |   /            <a class=nav-item data-path=/miscellaneous/ href=/miscellaneous/>Miscellaneous</a>   |
|                        <a class=nav-item data-path=/leftbrain/ href=/leftbrain/>LeftBrain</a>             <a class=nav-item data-path=/ai/ href=/ai/>AI</a>              |
+——————————————————————————————————————————————————————————————+
    </pre></nav><script defer src=/js/star-nav.js></script><script defer src=/js/site.js></script><script defer src=/js/star-active.js></script><div id=ref-window class="float-window open"><div class=float-header><span class="title open">>> >> >> Reference &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Ref>>>>>></span></div><div class=float-body><div class=ref-list><a href=https://www.mixamo.com/ target=_blank>Mixamo</a> |
<a href=https://opengameart.org/ target=_blank>OpenGameArt</a><p><a href=https://sharplab.io/ target=_blank>SharpLab</a> |
<a href=https://godbolt.org/ target=_blank>Compiler Explorer</a></p><p><a href="https://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type+Something+&x=none&v=4&h=4&w=80&we=false" target=_blank>ASCII Graph Generator</a></p><p><a href=https://mermaid.js.org/ target=_blank>Mermaid</a></p><a href=https://www.vim.org/ target=_blank>Vim</a> | <a href=https://vimdoc.sourceforge.net/ target=_blank>Vim Manual Source</a> |
<a href=https://vimcdoc.sourceforge.net/ target=_blank>Vimcdoc</a> | <a href=https://vimcdoc.sourceforge.net/doc/help.html target=_blank>Vimdoc read online</a><p><a href=https://shields.io/ target=_blank>Shields.io</a></p><p><a href=https://emojidb.org/ target=_blank>EmojiDB</a></p><p><a href=https://cppreference.com/ target=_blank>cppreference</a> |
<a href=https://isocpp.org/ target=_blank>isocpp</a> |
<a href=https://open-std.org target=_blank>open-std</a></p><p><a href=https://gcc.gnu.org/onlinedocs/ target=_blank>GCC Docs</a></p><p><a href=https://clang.llvm.org/docs/ target=_blank>Clang Docs</a></p><p><a href=https://www.boost.org/libraries/ target=_blank>Boost Library Docs</a></p><p><a href=https://learn.microsoft.com/en-us/dotnet/csharp/ target=_blank>Microsoft Learn</a><p><a href=https://www.lua.org/ target=_blank>lua.org</a> |
<a href=https://www.luarocks.org/ target=_blank>luarocks.org</a> |
<a href=https://www.luajit.org/ target=_blank>luajit.org</a></p><p><a href=https://docs.unity3d.com/Manual/index.html target=_blank>Unity Manual</a> |
<a href=https://docs.unity3d.com/ScriptReference/index.html target=_blank>Unity API</a></p><p><a href=https://docs.unrealengine.com/ target=_blank>Unreal Engine Docs</a></p><p><a href=https://godotengine.org target=_blank>Godot</a> |
<a href=https://docs.godotengine.org/en/stable/ target=_blank>Godot Docs</a></p><p><a href=https://z-library.sk/ target=_blank>Z-Library</a></p><p><a href=https://docs.kernel.org/ target=_blank>Linux Kernel Docs</a></p><p><a href=https://www.gnu.org/ target=_blank>GNU</a></p><a href=https://archlinux.org/ target=_blank>ArchLinux</a><p><a href=https://help.ubuntu.com/ target=_blank>Ubuntu Doc</a> |
<a href=https://ubuntu.com/server/docs target=_blank>Ubuntu Server Guide</a></p><p><a href=https://www.vulkan.org/ target=_blank>Vulkan</a> |
<a href=https://docs.vulkan.org/ target=_blank>Vulkan Docs</a></p><p><a href=https://www.opengl.org/ target=_blank>OpenGL</a> |
<a href=https://registry.khronos.org/OpenGL target=_blank>OpenGL API</a> |
<a href=https://www.khronos.org/opengl/wiki/ target=_blank>OpenGL Wiki</a></p><p><a href=https://learn.microsoft.com/en-us/windows/win32/directx target=_blank>DirectX</a></p><p><a href=https://www.realtimerendering.com/ target=_blank>Real-Time Rendering</a></p><p><a href=https://www.pbr-book.org/ target=_blank>Physically Based Rendering</a></p><p><a href=https://www.scratchapixel.com/ target=_blank>Scratchapixel</a></p><p><a href=https://learnopengl.com/ target=_blank>LearnOpenGL</a></p><p><a href=https://raytracing.github.io/ target=_blank>Ray Tracing in One Weekend</a></p><p><a href=https://www.shadertoy.com/ target=_blank>Shadertoy</a></p><p><a href=https://arxiv.org/list/cs.GR/recent target=_blank>arXiv Graphics</a></p><p><a href=https://www.siggraph.org/ target=_blank>SIGGRAPH</a> |
<a href=https://dl.acm.org/conference/siggraph target=_blank>SIGGRAPH Digital Library</a></p><p><a href=https://git-scm.com/ target=_blank>Git</a> |
<a href=https://git-scm.com/doc target=_blank>Docs</a> |
<a href=https://git-scm.com/community target=_blank>Community</a></p></div></div></div><script src=/js/ref-window.js></script><article class=single_article><div class=title>add<div class=meta>Modified: 2025-12-31
| Author：ljf12825</div></div><div class=content><p><code>git add</code>的作用是将新增或已更改文件的内容添加到index中，作为下次<code>commit</code>的内容<br>在一次<code>commit</code>之前，可以执行多次<code>add</code>，一次<code>add</code>就是一次拍照，内容是当前的新增或更改内容，如果后续对内容进行修改且希望提交，需要再次<code>add</code><br>默认情况下，<code>add</code>不会添加忽略文件，使用<code>--force</code>可强制添加。如果不使用<code>--force</code>，命令会失败并返回忽略的文件列表</p><h2 id=语义及设计理念>语义及设计理念</h2><p><code>git add</code>的作用不是“添加文件”，而是把工作区中的文件内容，写入Git对象数据库，并更新index中对应路径指向的对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>Working Tree（工作区）
</span></span><span style=display:flex><span>        ↓ git add
</span></span><span style=display:flex><span>Index / Staging Area（暂存区）
</span></span><span style=display:flex><span>        ↓ git commit
</span></span><span style=display:flex><span>Repository（对象库 + 提交历史）
</span></span></code></pre></div><p><code>git add</code>只负责从工作区读取文件内容，生成（或复用）blob对象，更新index，它不产生commit，也不更改HEAD</p><h3 id=底层行为>底层行为</h3><h4 id=git不关心文件只关心内容>Git不关心文件，只关心内容</h4><p>当执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add a.txt 
</span></span></code></pre></div><p>Git做的事情是</p><ul><li>读取a.txt内容</li><li>对内容计算SHA-1/SHA-256（新仓库）</li><li>生成一个<code>blob</code>对象（如果这个内容以前不存在）</li><li>把这个blob的hash写进index</li><li>index中记录</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>路径名 -&gt; blob hash + 文件模式
</span></span></code></pre></div><p>如果文件内容没变，<code>git add</code>不会生成新对象，这就是Git去重能力极强的根本原因</p><h4 id=index>index</h4><p>index存储下一次commit的完整快照草稿，index中的每一条记录包含</p><ul><li>文件路径</li><li>文件权限（100644/100755等）</li><li>blob对象hash</li></ul><h3 id=设计哲学>设计哲学</h3><p><code>git add</code>是Git的核心设计之一</p><h4 id=支持部分提交>支持部分提交</h4><p>假设改了一个文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>// main.c 
</span></span></span><span style=display:flex><span>修了 bug 
</span></span><span style=display:flex><span>加了日志
</span></span><span style=display:flex><span>写了一半新功能（未完成）
</span></span></code></pre></div><p>可以</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -p main.c 
</span></span></code></pre></div><p>只把bug修复，日志加入index,而把未完成的新功能留在工作区<br>Git的单位不是文件，是”内容块（hunk）“</p><h4 id=index的设计>index的设计</h4><p>index是缓冲层，如果没有<code>git add</code>，每次commit只能提交工作区的全部状态，无法构建干净、可回溯的历史</p><h2 id=options>OPTIONS</h2><ul><li><p><code>&lt;pathspec></code>
要添加的文件内容<br>可以使用文件通配符（例如，<code>*.c</code>）来添加所有匹配的文件<br>也可以指定一个前导目录名（例如<code>dir/</code>来添加<code>dir/</code>下所有文件）<br><code>.</code>也是<code>&lt;pathspec></code>，是指从当前目录开始，递归匹配所有路径，<code>git add .</code>，在不同Git版本/配置下，会add新文件，会add修改文件，可能不会stage删除
<code>&lt;pathspec></code>是一个匹配规则系统，支持：目录，glob,排除，魔法前缀</p></li><li><p><code>-n</code>/<code>--dry-run</code>
模拟执行</p></li><li><p><code>-v</code>/<code>--verbose</code>
尽可能多的显示信息</p></li><li><p><code>-f</code>/<code>--force</code>
允许添加已忽略的文件</p></li><li><p><code>--sparse</code>
允许更新sparse-checkout范围之外的索引条目。通常情况下，<code>git add</code>命令会拒绝更新路径不再sparse-checkout范围内的索引条目，因为这些文件可能会在未发出警告的情况下从工作树中移除</p></li><li><p><code>-i</code>/<code>--interactive</code>
以交互方式将工作树中修改后的内容添加到索引中。可以提供可选的路径参数，以将操作限制在工作树的子集中</p></li><li><p><code>p</code>/<code>--patch</code>
以交互方式选择索引和工作树之间的补丁块，并将其添加到索引中。这使用户有机会在将修改后的内容添加到索引之前查看差异。这实际上运行了<code>add--interactive</code>命令，但绕过了初始命令菜单，直接跳转到补丁子命令</p></li><li><p><code>-U&lt;n></code>/<code>--unified=&lt;n></code>
生成包含<n>行上下问的而差异。默认值为diff.context,如果未设置配置选项，则默认值为3</p></li><li><p><code>--inter-hunk-context=&lt;n></code>
显示差异代码块之间的上下文，最多显示指定的行数，从而合并彼此接近 的代码块。默认值为diff.interHunkContext,如果为设置配置选项，则默认值为0</p></li><li><p><code>-e</code>/<code>--edit</code>
在编辑器中打开差异文件与索引的对比，并允许用户进行编辑。编辑器关闭后，调整代码块标题并将补丁应用到索引。此选项的目的是选择要应用的补丁行，甚至可以修改要暂存的行的内容。这比使用交互式代码块选择器更快、更灵活。但是很容易出错，导致创建了一个不适用于索引的补丁</p></li><li><p><code>-u</code>/<code>--update</code>
仅更新索引中已存在与<code>&lt;pathspec></code>匹配的条目。此操作会删除并修改索引条目以匹配工作树，但不会添加新文件。如果在使用<code>-u</code>选项时未指定<code>&lt;pathspec></code>，则会更新整个工作树中所有跟踪的文件（旧版本的Git会将更新限制在当前目录及其子目录中）</p></li><li><p><code>-A</code>/<code>--all</code>/<code>--no-ignore-removal</code>
不仅更新工作树中存在与<code>&lt;pathspec></code>匹配的文件的索引，还会更新索引中已存在条目的文件。此操作会根据工作树添加、修改和删除索引条目。如果在使用<code>-A</code>选项时未执行<code>&lt;pathspec></code>，则会更新整个工作树中的所有文件（旧版本的Git会将更新限制在当前目录及其子目录中），简单来说，该操作会复刻工作区中的所有行为（添加，修改，删除）到index</p></li><li><p><code>--no-all</code>/<code>--ignore-removal</code>
更新index，只处理新增和修改，忽略“已删除”的文件。新文件: 加入index, 修改文件: 更新index, 删除文件: index中仍保留（不stage删除）。当不提供<code>&lt;pathspec></code>时，这个选项是no-op（无效）</p></li><li><p><code>-N</code>/<code>--intent-to-add</code>
在index中记录“我打算将来add这个文件”，但不记录内容。index中有路径，但没有blob内容，这是一个空条目。在Git内部，index有该文件的entry, blob hash是“未定义状态”，文件被视为tracked（已跟踪），但内容仍完全来自工作区，还未进入对象数据库。<code>-N</code>是一个逻辑跟踪标记，不是内容操作。这个功能的作用：1.让<code>git diff</code>显示“未add的新文件内容”，默认情况下<code>git diff</code>不会显示新文件内容，因为diff的基准是index，新文件index不存在，<code>-N</code>选项让diff可以显示出新文件内容。2.配合<code>git commit -a</code>，<code>git commit -a</code>只会提交tracked文件。如果想用<code>commit -a</code>但又有新文件，可以使用<code>-N</code></p></li><li><p><code>--refresh</code>
不添加内容，只更新index中的stat信息。index里除了blob hash,还有文件大小，mtime,inode（部分系统）。Git用这些来做快速是否变更判断。使用场景：文件内容没变，但时间戳/元数据异常，Git误判为modified，使用<code>git add --refresh</code>修正index的文件状态缓存</p></li><li><p><code>--ignore-errors</code>
部分文件add失败，不中断整个add操作。行为：成功的：继续add,失败的：跳过，最终返回非0.Git默认是要么全部成功，要么失败。这个选项是尽量成功，但告诉你有问题</p></li><li><p><code>--ignore-missing</code>
检查pathspec中哪些文件会被忽略，不关心它们是否存在。该命令只能和<code>--dry-run</code>一起用，不修改index</p></li><li><p><code>--no-warn-embedded-repo</code>
当<code>git add some_dir/</code>，而<code>some_dir/.git</code>存在时，Git会警告：你正在添加一个嵌套仓库。因为这通常意味着：子模块没有正确处理，历史会混乱。这个选项的作用是关闭该警告，你需要明确知道自己在干什么</p></li><li><p><code>--renormalize</code>
对所有已跟踪文件，重新执行官clean过滤器，然后重新写入index. 典型clean行为：CRLF->LF, text属性生效。触发场景：修改了<code>core.autocrlf</code>,<code>.gitattributes</code>的<code>text</code>/<code>eol</code>、历史index中内容脏了。该命令只会影响index,不修改工作区文件，隐含<code>-u</code></p></li><li><p><code>--chmod=(+|-)x</code>
只修改index中的可执行位，不修改磁盘文件，只改Git记录</p></li><li><p><code>--pathspec-from-file</code>/<code>--pathspec-file-nul</code>
pathspec不从命令行传，而是从文件/stdin读。适用于路径太多，路径包含空格、换行、特殊字符、自动化工具生成路径列表。<code>--pathspec-file-nul</code>用<code>\0</code>分隔，所有字符字面量处理，最安全的批量路径方式</p></li><li><p><code>--</code>
选项终止符，明确告诉Git：后面全是路径，不是选项</p></li></ul><h2 id=交互式add>交互式<code>add</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 启动交互式暂存界面</span>
</span></span><span style=display:flex><span>git add -i
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 或使用完整命令</span>
</span></span><span style=display:flex><span>git add --interactive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 简写模式（更新版本）</span>
</span></span><span style=display:flex><span>git add -p <span style=color:#6272a4># 补丁模式，最常用</span>
</span></span></code></pre></div><p>启动后显示菜单</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>           staged     unstaged path
</span></span><span style=display:flex><span>  1:    unchanged       +12/-0 README.md
</span></span><span style=display:flex><span>  2:    unchanged       +20/-4 src/main.py
</span></span><span style=display:flex><span>  3:    unchanged        +3/-0 newfile.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>*** Commands ***
</span></span><span style=display:flex><span>  1: status       2: update       3: revert       4: add untracked
</span></span><span style=display:flex><span>  5: patch        6: diff         7: quit         8: help
</span></span><span style=display:flex><span>What now&gt;
</span></span></code></pre></div><ol><li>status（状态）</li></ol><p>显示当前更改的摘要信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 显示哪些文件已暂存、未暂存</span>
</span></span></code></pre></div><ol start=2><li>update（更新）</li></ol><p>将整个文件的更改添加到暂存区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>           staged     unstaged path
</span></span><span style=display:flex><span>  1:    unchanged       +12/-0 README.md
</span></span><span style=display:flex><span>  2:    unchanged       +20/-4 src/main.py
</span></span><span style=display:flex><span>Update&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#6272a4># 输入文件编号（如 1,2 或 1-3）</span>
</span></span><span style=display:flex><span>Update&gt;&gt; 1,2
</span></span><span style=display:flex><span><span style=color:#6272a4># 暂存选中文件的全部更改</span>
</span></span></code></pre></div><ol start=3><li>revert（恢复）</li></ol><p>从暂存区移除已暂存的文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span>           staged     unstaged path
</span></span><span style=display:flex><span>  1:        +12/-0    unchanged README.md
</span></span><span style=display:flex><span>Revert&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#6272a4># 输入要取消暂存的文件编号</span>
</span></span></code></pre></div><ol start=4><li>add untracked（添加未跟踪文件）</li></ol><p>添加新文件到暂存区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>           staged     unstaged path
</span></span><span style=display:flex><span>  1:    unchanged        +3/-0 newfile.txt
</span></span><span style=display:flex><span>Add untracked&gt;&gt;
</span></span></code></pre></div><ol start=5><li>patch（补丁模式）</li></ol><p>逐块暂存更改-这是交互式add的核心功能</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>5</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 或直接使用补丁模式</span>
</span></span><span style=display:flex><span>git add -p
</span></span><span style=display:flex><span>git add --patch
</span></span></code></pre></div><ol start=6><li>diff（查看差异）</li></ol><p>显示暂存区与工作区的差异</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>What now&gt; <span style=color:#bd93f9>6</span>
</span></span><span style=display:flex><span>           staged     unstaged path
</span></span><span style=display:flex><span>  1:        +12/-0     +4/-2 README.md
</span></span><span style=display:flex><span>Diff&gt;&gt;
</span></span><span style=display:flex><span><span style=color:#6272a4># 输入文件编号查看具体差异</span>
</span></span></code></pre></div><ol start=7><li>quit（退出）</li></ol><p>退出交互式界面</p><ol start=8><li>help（帮助）</li></ol><p>显示命令帮助信息</p><h2 id=补丁模式>补丁模式</h2><p>启动补丁模式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 对特定文件使用补丁模式</span>
</span></span><span style=display:flex><span>git add -p filename.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 对所有更改文件使用</span>
</span></span><span style=display:flex><span>git add -p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 等价于</span>
</span></span><span style=display:flex><span>git add --patch
</span></span></code></pre></div><p>补丁模式的工作流程</p><ol><li>Git逐块显示更改</li><li>每个块前显示选项提示</li><li>用户选择如何操作该块</li><li>继续处理下一个块</li></ol><h3 id=选项>选项</h3><p>当Git显示一个代码块时，会提示</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>Stage this hunk [y,n,q,a,d,j,J,g,/,s,e,?]?
</span></span></code></pre></div><p>常用选项</p><ul><li>y(yes)：暂存此块</li><li>n(no)：不暂存此块</li><li>q(quit)：退出，不暂存当前块及后续所有块</li><li>a(all)：暂存当前文件的所有块</li><li>d(done)：不暂存当前文件的所有块</li><li>j(jump)：跳过当前块，暂不决定</li><li>J(Join)：跳到下一个块，但把当前块合并到下一个</li><li>g(goto)：选择特定块处理</li><li>/(search)：用正则表达式搜索块</li><li>s(split)：将当前大块分割成更小的块</li><li>e(edit)：手动编辑当前块</li><li>?(help)：显示帮助</li></ul><h4 id=ssplit-分割大块>s(split) 分割大块</h4><p>当Git显示的块太大，包含多个逻辑更改时</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-diff data-lang=diff><span style=display:flex><span><span style=font-weight:700>@@ -10,7 +10,10 @@ def calculate_total(items)
</span></span></span><span style=display:flex><span>    total = 0
</span></span><span style=display:flex><span>    for item in items:
</span></span><span style=display:flex><span>        total += item.price
</span></span><span style=display:flex><span><span style=color:#f55>-   return total
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+   # 添加折扣计算
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+   # discount = total * 0.1
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+   return total - discount
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 另一个不相关的函数
</span></span><span style=display:flex><span>def validate_input(data):
</span></span></code></pre></div><p>输入<code>s</code>后，Git会尝试将大块分割成更小的逻辑块</p><h4 id=eedit-手动编辑>e(edit) 手动编辑</h4><ul><li>选择特定暂存行</li><li>修改要暂存的内容</li><li>完全自定义暂存内容</li></ul><p>输入<code>e</code>后进入编辑界面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-diff data-lang=diff><span style=display:flex><span># Manual hunk edit mode -- see bottom for a quick guide.
</span></span><span style=display:flex><span><span style=font-weight:700>@@ -10,7 +10,10 @@ def calculate_total(items):
</span></span></span><span style=display:flex><span>     total = 0
</span></span><span style=display:flex><span>     for item in items:
</span></span><span style=display:flex><span>         total += item.price
</span></span><span style=display:flex><span><span style=color:#f55>-    return total
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+    
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+    # 添加折扣计算
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+    discount = total * 0.1
</span></span></span><span style=display:flex><span><span style=color:#50fa7b;font-weight:700>+    return total - discount
</span></span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span># ---
</span></span><span style=display:flex><span># To remove &#39;-&#39; lines, make them &#39; &#39; lines (context).
</span></span><span style=display:flex><span># To remove &#39;+&#39; lines, delete them.
</span></span><span style=display:flex><span># Lines starting with # will be removed.
</span></span></code></pre></div><p>编辑规则</p><ul><li>保留<code>-</code>开头的行：从暂存区删除</li><li>删除<code>+</code>开头的行：不添加这些更改</li><li>将<code>-</code>改为空格：保留原行</li><li>添加新行：使用<code>+</code>开头</li></ul><h4 id=hunk>Hunk</h4><p>在Git中，Hunk是diff输出的一个基本单位，代表文件中一组连续的更改行。一个hunk包含</p><ul><li>上下文行（未更改）</li><li>删除的行（以<code>-</code>开头）</li><li>添加的行（以<code>+</code>开头）</li></ul></div><nav class=post-nav><a href=/unixlike/log/gitlocalrepo/ class=hover:underline>pre: .git/</a>
<a href=/unixlike/log/archive/ class=hover:underline>next: archive</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><ul><li><a href=#语义及设计理念>语义及设计理念</a><ul><li><a href=#底层行为>底层行为</a><ul><li><a href=#git不关心文件只关心内容>Git不关心文件，只关心内容</a></li><li><a href=#index>index</a></li></ul></li><li><a href=#设计哲学>设计哲学</a><ul><li><a href=#支持部分提交>支持部分提交</a></li><li><a href=#index的设计>index的设计</a></li></ul></li></ul></li><li><a href=#options>OPTIONS</a></li><li><a href=#交互式add>交互式<code>add</code></a></li><li><a href=#补丁模式>补丁模式</a><ul><li><a href=#选项>选项</a><ul><li><a href=#ssplit-分割大块>s(split) 分割大块</a></li><li><a href=#eedit-手动编辑>e(edit) 手动编辑</a></li><li><a href=#hunk>Hunk</a></li></ul></li></ul></li></ul></li></ul></nav></aside><script src=/js/scrollspy.js defer></script><script type=module>
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ 
    startOnLoad: true, theme: "default" });
</script><footer><div class=container><p>© 2026 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSES.md>Full License</a></p></div></footer></body></html>