<!doctype html><html lang=en><head><meta name=page-kind content="page"><meta charset=UTF-8><title>Hooks</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-lua.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-rust.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=stylesheet href=/css/logsingle.css></head><body><header class=site-header><div class=container><div class=terminal-overlay aria-label=terminal-prompt><span id=typed-line></span><span class=cursor>█</span></div></div></header><nav class=topnav><div class=container><ul><li><a href=/unixlike/>★</a></li><li><a href=/unixlike/lab/>Lab</a></li><li><a href=/unixlike/log/>Log</a></li><li><a href=/unixlike/file/>File</a></li></ul></div></nav><nav id=star-nav><div id=star-header><span class="title open">>> >> >> Navigation &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Nav>>>>>></span></div><pre class=ascii>
+——————————————————————————————————————————————————————————————+
|                        <a class=nav-item data-path=/rightbrain/ href=/rightbrain/>RightBrain</a>                            |
|                             |                                |
|                             |     <a class=nav-item data-path=/dotnetandwindows/ href=/dotnetandwindows/>.NET-Windows</a>               |
|                             |    /                           |
|                             |   /                            |
|                             |  /                             |
|                             | /                              |
|                             |/                               |
|      <a class=nav-item data-path=/graphic/ href=/graphic/>Graphic</a> ———————————— <a class=nav-item data-path=/home/ href=/home/>Home</a> ————————————— <a class=nav-item data-path=/runtime/ href=/runtime/>Runtime</a>         |
|                            /|                                |
|                           / |                                |
|                          /  |                                |
|                         /   |       <a class=nav-item data-path=/language/ href=/language/>Language</a>                 |
|                        /    |      /                         |
|                       /     |     /                          |
|              <a class=nav-item data-path=/unixlike/ href=/unixlike/>Unix-like</a>      |    /           <a class=nav-item data-path=/project/ href=/project/>Project</a>         |
|                             |   /            <a class=nav-item data-path=/miscellaneous/ href=/miscellaneous/>Miscellaneous</a>   |
|                        <a class=nav-item data-path=/leftbrain/ href=/leftbrain/>LeftBrain</a>             <a class=nav-item data-path=/ai/ href=/ai/>AI</a>              |
+——————————————————————————————————————————————————————————————+
    </pre></nav><script defer src=/js/star-nav.js></script><script defer src=/js/site.js></script><script defer src=/js/star-active.js></script><div id=ref-window class="float-window open"><div class=float-header><span class="title open">>> >> >> Reference &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Ref>>>>>></span></div><div class=float-body><div class=ref-list><a href=https://www.mixamo.com/ target=_blank>Mixamo</a> |
<a href=https://opengameart.org/ target=_blank>OpenGameArt</a><p><a href=https://sharplab.io/ target=_blank>SharpLab</a> |
<a href=https://godbolt.org/ target=_blank>Compiler Explorer</a></p><p><a href="https://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type+Something+&x=none&v=4&h=4&w=80&we=false" target=_blank>ASCII Graph Generator</a></p><p><a href=https://mermaid.js.org/ target=_blank>Mermaid</a></p><a href=https://www.vim.org/ target=_blank>Vim</a> | <a href=https://vimdoc.sourceforge.net/ target=_blank>Vim Manual Source</a> |
<a href=https://vimcdoc.sourceforge.net/ target=_blank>Vimcdoc</a> | <a href=https://vimcdoc.sourceforge.net/doc/help.html target=_blank>Vimdoc read online</a><p><a href=https://shields.io/ target=_blank>Shields.io</a></p><p><a href=https://emojidb.org/ target=_blank>EmojiDB</a></p><p><a href=https://cppreference.com/ target=_blank>cppreference</a></p><p><a href=https://gcc.gnu.org/onlinedocs/ target=_blank>GCC Docs</a></p><p><a href=https://clang.llvm.org/docs/ target=_blank>Clang Docs</a></p><p><a href=https://www.boost.org/libraries/ target=_blank>Boost Library Docs</a></p><p><a href=https://learn.microsoft.com/en-us/dotnet/csharp/ target=_blank>Microsoft Learn</a><p><a href=https://www.lua.org/ target=_blank>lua.org</a>
<a href=https://www.luarocks.org/ target=_blank>luarocks.org</a>
<a href=https://www.luajit.org/ target=_blank>luajit.org</a></p><p><a href=https://docs.unity3d.com/Manual/index.html target=_blank>Unity Manual</a> |
<a href=https://docs.unity3d.com/ScriptReference/index.html target=_blank>Unity API</a></p><p><a href=https://docs.unrealengine.com/ target=_blank>Unreal Engine Docs</a></p><p><a href=https://godotengine.org target=_blank>Godot</a> |
<a href=https://docs.godotengine.org/en/stable/ target=_blank>Godot Docs</a></p><p><a href=https://z-library.sk/ target=_blank>Z-Library</a> : eBook Library</p><p><a href=https://docs.kernel.org/ target=_blank>Linux Kernel Docs</a></p><p><a href=https://www.gnu.org/ target=_blank>GNU</a> : manuals, philosophy, FAQ</p><a href=https://archlinux.org/ target=_blank>ArchLinux</a><p><a href=https://help.ubuntu.com/ target=_blank>Ubuntu Doc</a> |
<a href=https://ubuntu.com/server/docs target=_blank>Ubuntu Server Guide</a></p><p><a href=https://www.vulkan.org/ target=_blank>Vulkan</a> |
<a href=https://docs.vulkan.org/ target=_blank>Vulkan Docs</a></p><p><a href=https://www.opengl.org/ target=_blank>OpenGL</a> |
<a href=https://registry.khronos.org/OpenGL target=_blank>OpenGL API</a> |
<a href=https://www.khronos.org/opengl/wiki/ target=_blank>OpenGL Wiki</a></p><p><a href=https://learn.microsoft.com/en-us/windows/win32/directx target=_blank>DirectX</a></p><p><a href=https://www.realtimerendering.com/ target=_blank>Real-Time Rendering</a></p><p><a href=https://www.pbr-book.org/ target=_blank>Physically Based Rendering</a></p><p><a href=https://www.scratchapixel.com/ target=_blank>Scratchapixel</a></p><p><a href=https://learnopengl.com/ target=_blank>LearnOpenGL</a></p><p><a href=https://raytracing.github.io/ target=_blank>Ray Tracing in One Weekend</a></p><p><a href=https://www.shadertoy.com/ target=_blank>Shadertoy</a></p><p><a href=https://arxiv.org/list/cs.GR/recent target=_blank>arXiv Graphics</a></p><p><a href=https://www.siggraph.org/ target=_blank>SIGGRAPH</a> |
<a href=https://dl.acm.org/conference/siggraph target=_blank>SIGGRAPH Digital Library</a></p><p><a href=https://git-scm.com/ target=_blank>Git</a> |
<a href=https://git-scm.com/doc target=_blank>Docs</a> |
<a href=https://git-scm.com/community target=_blank>Community</a></p></div></div></div><script src=/js/ref-window.js></script><article class=single_article><div class=title>Hooks<div class=meta>Modified: 2025-12-31
| Author：ljf12825</div></div><div class=content><p>Git Hooks是Git在特定重要动作（如提交、推送、接收等）发生时自动运行的脚本。它们是一种内置的功能，允许自定义和自动化Git的工作流程<br>可以把Git Hooks想象成事件监听器。当Git执行到某个关键节点时（比如<code>pre-commit</code>，<code>post-merge</code>），它会检查对应的钩子脚本是否存在。如果存在并且有执行权限，Git就会运行这个脚本</p><ul><li>如果脚本成功退出（返回0），Git就继续执行后续操作</li><li>如果脚本非正常退出（返回非0），Git就会中止当前的操作。这正是钩子用来强制执行策略的强大之处</li></ul><p>每个Git仓库都有一个内置的钩子目录：<code>.git/hooks/</code>。在这个目录下，会看到许多示例脚本（以<code>.sample</code>结尾），它们展示了各种钩子的用法<br>不能直接创建任意名称的全新钩子（比如<code>pre-deploy</code>）。Git的钩子系统是固定事件的，它只会在预定义的特定生命周期节点去查找对应的脚本文件<br>但可以利用现有钩子来模拟或触发自定义事件，实现“自定义时间”执行操作的效果。这是非常常见的做法<br>重要提示：<code>.git/</code>目录本身不被版本控制。因此<code>.git/hooks/</code>下的脚本也无法通过Git共享给项目组的其他成员。这是一个本地化的设置。如果需要团队共享钩子，需要额外的步骤</p><h3 id=常用hooks类型>常用Hooks类型</h3><p>钩子主要分为两大类：客户端钩子（在你的电脑上运行）和服务端钩子（在Git服务器上运行，如GitLab，Gitea，GHE）</p><h4 id=客户端钩子最常见>客户端钩子（最常见）</h4><ol><li><code>pre-commit</code></li></ol><ul><li>时机：在键入提交信息之前运行</li><li>用途：检查代码快照（即将提交的内容）。通常用于运行代码风格检查（如ESLint，Black）、测试或检查是否有调试语句（如<code>console.log</code>）</li><li>中止：如果该脚本退出非零，则中止提交。可以用<code>git commit --no-verify</code>绕过</li></ul><ol start=2><li><code>prepare-commit-msg</code></li></ol><ul><li>时机：在默认提交信息准备好之后，编辑器启动之前</li><li>用途：允许动态地修改自动生成的提交信息模板（例如，合并或压缩提交时的默认信息）</li></ul><ol start=3><li><code>commit-msg</code></li></ol><ul><li>时机：在用户输入提交信息之后运行</li><li>用途：检查提交信息是否符合规范（例如，必须符合Conventional Commits规范，必须有任务号等）</li><li>中止：如果信息不符合规范，可以拒绝提交</li></ul><ol start=4><li><code>post-commit</code></li></ol><ul><li>时机：在整个提交过程完成之后进行</li><li>用途：主要用于通知，例如发送邮件或触发一个CI构建（但现在更推荐在服务端做）</li></ul><ol start=5><li><code>pre-push</code></li></ol><ul><li>时机：在<code>git push</code>运行之后，任何东西被推送到远程之前</li><li>用途：在推送代码前运行更耗时的完整测试套件或检查，确保推送到远程的代码是高质量的</li></ul><h4 id=服务端钩子>服务端钩子</h4><ol><li><code>pre-receive</code></li></ol><ul><li>时机：在服务器处理来自客户端的推送操作时，最先运行的钩子</li><li>用途：检查所有推送的提交。可用于实施强制性的公司策略，例如“所有提交信息必须有关联的任务号”，“禁止向主分支推送”等</li></ul><ol start=2><li><code>update</code></li></ol><ul><li>类似于<code>pre-receive</code>，但会为每一个要更新的分支各运行一次</li></ul><ol start=3><li><code>post-receive</code></li></ol><ul><li>时机：在整个推送过程完结之后运行</li><li>用途：用于通知他人、触发部署、或者更新问题追踪系统。这是自动部署最常用的钩子</li></ul><h3 id=使用hooks>使用Hooks</h3><p>创建一个钩子：</p><ul><li>进入项目的<code>.git/hooks/</code>目录</li><li>创建一个文件，文件名必须是钩子的名称（如<code>pre-commit</code>，<code>commit-msg</code>），不能有扩展名</li><li>在文件的开头写入sheban（指定脚本解释器），例如<code>#!/bin/sh</code>用于Shell脚本，或<code>#!/usr/bin/env node</code>用于Node.js脚本</li><li>编写脚本逻辑</li><li>确保该文件是可执行的（<code>chmod +x .git/hooks/pre-commit</code>）</li></ul><h3 id=如何团队共享git-hooks>如何团队共享Git Hooks</h3><p>如前所述，<code>.git/hooks</code>不纳入版本控制。要让团队所有成员使用相同的钩子，有几种常见方法：</p><ol><li>手动复制：最原始的方法，但非常容易出错且难以维护</li><li>符号链接：将<code>.git/hooks</code>目录链接到项目中的一个受版本控制的目录</li><li>使用第三方工具（推荐）
这些工具可以帮助管理钩子，并确保它们被安装到每个团队成员的本地仓库中</li></ol><ul><li>Husky（最流行）：现代前端项目的首选。它让配置Git Hooks变得非常简单，只需在<code>package.json</code>中配置即可</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#6272a4>// package.json
</span></span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;husky&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;hooks&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;pre-commit&#34;</span>: <span style=color:#f1fa8c>&#34;lint-staged&#34;</span>, <span style=color:#6272a4>// 在提交前运行 lint-staged
</span></span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;commit-msg&#34;</span>: <span style=color:#f1fa8c>&#34;commitlint -E HUSKY_GIT_PARAMS&#34;</span> <span style=color:#6272a4>// 检查提交信息
</span></span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>安装Husky后，它会自动将其脚本安装到你的<code>.git/hooks</code>目录中</p><h4 id=husky运行原理>Husky运行原理</h4><p>Husky采用了一种非常巧妙的安装和代理机制。它主要做了两件事</p><ol><li>在<code>.git/hooks</code>中安装代理脚本</li><li>在项目根目录存储真实的配置</li></ol><h5 id=第一步安装-husky-install>第一步：安装-<code>husky install</code></h5><p>当运行<code>npx husky install</code>或通过<code>npm prepare</code>脚本自动安装时，Husky会执行以下操作</p><ol><li>在<code>.git/hooks</code>中创建文件：Husky会为每一个它支持的Git钩子（如<code>pre-commit</code>，<code>commit-msg</code>,<code>pre-push</code>等）在<code>.git/hooks/</code>目录下创建一个同名的文件</li><li>这些文件时代理脚本：这些文件不是真正的钩子逻辑，而是Husky的统一入口脚本。所有这些都是完全相同的脚本，内容大致如下</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#6272a4># 这是一个Husky创建的代理钩子文件</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 它主要做一件事：去调用Husky的核心程序，并告诉它现在触发的是哪个钩子</span>
</span></span><span style=display:flex><span>husky<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 设置环境变量，告诉husky是哪个钩子被触发了</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>HUSKY_GIT_PARAMS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$*</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 运行Husky的核心命令</span>
</span></span><span style=display:flex><span>    npx --no-install husky run <span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>besename <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$0</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 运行上面定义的函数</span>
</span></span><span style=display:flex><span>husky <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$@</span><span style=color:#f1fa8c>&#34;</span>
</span></span></code></pre></div><p>这个代理脚本的作用是：无论哪个Git钩子被触发，都会把执行权交给<code>husky run</code>命令</p><h5 id=第二步存储配置-在版本控制中>第二步：存储配置-在版本控制中</h5><p>真实的钩子配置并不在<code>.git/hooks</code>里，而是在项目根目录下</p><ol><li>Husky的配置目录：Husky默认会在项目根目录创建一个<code>.husky/</code>目录</li><li>存储真实的钩子：在<code>.husky/</code>目录下，可以看到实际执行的脚本文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>your-project/
</span></span><span style=display:flex><span>├── .husky/
</span></span><span style=display:flex><span>│   ├── pre-commit    &lt;-- 真正的pre-commit钩子
</span></span><span style=display:flex><span>│   ├── commit-msg    &lt;-- 真正的commit-msg钩子
</span></span><span style=display:flex><span>│   └── _/           &lt;-- Husky的内部辅助文件
</span></span><span style=display:flex><span>├── .git/
</span></span><span style=display:flex><span>│   └── hooks/
</span></span><span style=display:flex><span>│       ├── pre-commit -&gt; ../../.husky/pre-commit 代理脚本
</span></span><span style=display:flex><span>│       └── ...
</span></span><span style=display:flex><span>├── package.json
</span></span><span style=display:flex><span>└── ...
</span></span></code></pre></div><ol start=3><li><code>.husky/pre-commit</code>文件里的内容可能是</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/sh
</span></span></span><span style=display:flex><span>. <span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>dirname <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$0</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c>/_/husky.sh&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>npm <span style=color:#8be9fd;font-style:italic>test</span> <span style=color:#6272a4># 运行测试</span>
</span></span><span style=display:flex><span>npx lint-staged <span style=color:#6272a4># 运行lint-staged</span>
</span></span></code></pre></div><h5 id=第三步执行流程-钩子被触发时>第三步：执行流程-钩子被触发时</h5><p>当在项目中执行<code>git commit</code>时</p><ol><li>Git发现要执行提交操作，于是查找<code>.git/hooks/pre-commit</code>文件</li><li>找到的时Husky安装的代理脚本，并执行它</li><li>代理脚本运行<code>npx husky run pre-commit</code>命令</li><li><code>husky run</code>命令开始工作</li></ol><ul><li>它读取项目根目录下<code>.husky/</code>文件夹</li><li>查找对应的<code>pre-commit</code>文件</li><li>执行该文件中的命令（如<code>npm test</code>, <code>npx lint-staged</code>）</li></ul><ol start=5><li>如果这些命令全部成功（退出码为0），提交继续；如果有任何一个失败，提交中止</li></ol></div><nav class=post-nav><a href=/unixlike/log/help/ class=hover:underline>pre: help</a>
<a href=/unixlike/log/init/ class=hover:underline>next: init</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#常用hooks类型>常用Hooks类型</a><ul><li><a href=#客户端钩子最常见>客户端钩子（最常见）</a></li><li><a href=#服务端钩子>服务端钩子</a></li></ul></li><li><a href=#使用hooks>使用Hooks</a></li><li><a href=#如何团队共享git-hooks>如何团队共享Git Hooks</a><ul><li><a href=#husky运行原理>Husky运行原理</a><ul><li><a href=#第一步安装-husky-install>第一步：安装-<code>husky install</code></a></li><li><a href=#第二步存储配置-在版本控制中>第二步：存储配置-在版本控制中</a></li><li><a href=#第三步执行流程-钩子被触发时>第三步：执行流程-钩子被触发时</a></li></ul></li></ul></li></ul></li></ul></li></ul></nav></aside><script src=/js/scrollspy.js defer></script><script type=module>
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ 
    startOnLoad: true, theme: "default" });
</script><footer><div class=container><p>© 2026 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSES.md>Full License</a></p></div></footer></body></html>