<!doctype html><html lang=en><head><meta name=page-kind content="page"><meta charset=UTF-8><title>Subtree</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-lua.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-rust.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=stylesheet href=/css/logsingle.css></head><body><header class=site-header><div class=container><div class=terminal-overlay aria-label=terminal-prompt><span id=typed-line></span><span class=cursor>█</span></div></div></header><nav class=topnav><div class=container><ul><li><a href=/unixlike/>★</a></li><li><a href=/unixlike/lab/>Lab</a></li><li><a href=/unixlike/log/>Log</a></li><li><a href=/unixlike/file/>File</a></li></ul></div></nav><nav id=star-nav><div id=star-header><span class="title open">>> >> >> Navigation &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Nav>>>>>></span></div><pre class=ascii>
+——————————————————————————————————————————————————————————————+
|                        <a class=nav-item data-path=/rightbrain/ href=/rightbrain/>RightBrain</a>                            |
|                             |                                |
|                             |     <a class=nav-item data-path=/dotnetandwindows/ href=/dotnetandwindows/>.NET-Windows</a>               |
|                             |    /                           |
|                             |   /                            |
|                             |  /                             |
|                             | /                              |
|                             |/                               |
|      <a class=nav-item data-path=/graphic/ href=/graphic/>Graphic</a> ———————————— <a class=nav-item data-path=/home/ href=/home/>Home</a> ————————————— <a class=nav-item data-path=/runtime/ href=/runtime/>Runtime</a>         |
|                            /|                                |
|                           / |                                |
|                          /  |                                |
|                         /   |       <a class=nav-item data-path=/language/ href=/language/>Language</a>                 |
|                        /    |      /                         |
|                       /     |     /                          |
|              <a class=nav-item data-path=/unixlike/ href=/unixlike/>Unix-like</a>      |    /           <a class=nav-item data-path=/project/ href=/project/>Project</a>         |
|                             |   /            <a class=nav-item data-path=/miscellaneous/ href=/miscellaneous/>Miscellaneous</a>   |
|                        <a class=nav-item data-path=/leftbrain/ href=/leftbrain/>LeftBrain</a>             <a class=nav-item data-path=/ai/ href=/ai/>AI</a>              |
+——————————————————————————————————————————————————————————————+
    </pre></nav><script defer src=/js/star-nav.js></script><script defer src=/js/site.js></script><script defer src=/js/star-active.js></script><div id=ref-window class="float-window open"><div class=float-header><span class="title open">>> >> >> Reference &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Ref>>>>>></span></div><div class=float-body><div class=ref-list><a href=https://www.mixamo.com/ target=_blank>Mixamo</a> |
<a href=https://opengameart.org/ target=_blank>OpenGameArt</a><p><a href=https://sharplab.io/ target=_blank>SharpLab</a> |
<a href=https://godbolt.org/ target=_blank>Compiler Explorer</a></p><p><a href="https://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type+Something+&x=none&v=4&h=4&w=80&we=false" target=_blank>ASCII Graph Generator</a></p><p><a href=https://mermaid.js.org/ target=_blank>Mermaid</a></p><a href=https://www.vim.org/ target=_blank>Vim</a> | <a href=https://vimdoc.sourceforge.net/ target=_blank>Vim Manual Source</a> |
<a href=https://vimcdoc.sourceforge.net/ target=_blank>Vimcdoc</a> | <a href=https://vimcdoc.sourceforge.net/doc/help.html target=_blank>Vimdoc read online</a><p><a href=https://shields.io/ target=_blank>Shields.io</a></p><p><a href=https://emojidb.org/ target=_blank>EmojiDB</a></p><p><a href=https://cppreference.com/ target=_blank>cppreference</a> |
<a href=https://isocpp.org/ target=_blank>isocpp</a> |
<a href=https://open-std.org target=_blank>open-std</a></p><p><a href=https://gcc.gnu.org/onlinedocs/ target=_blank>GCC Docs</a></p><p><a href=https://clang.llvm.org/docs/ target=_blank>Clang Docs</a></p><p><a href=https://www.boost.org/libraries/ target=_blank>Boost Library Docs</a></p><p><a href=https://learn.microsoft.com/en-us/dotnet/csharp/ target=_blank>Microsoft Learn</a><p><a href=https://www.lua.org/ target=_blank>lua.org</a> |
<a href=https://www.luarocks.org/ target=_blank>luarocks.org</a> |
<a href=https://www.luajit.org/ target=_blank>luajit.org</a></p><p><a href=https://docs.unity3d.com/Manual/index.html target=_blank>Unity Manual</a> |
<a href=https://docs.unity3d.com/ScriptReference/index.html target=_blank>Unity API</a></p><p><a href=https://docs.unrealengine.com/ target=_blank>Unreal Engine Docs</a></p><p><a href=https://godotengine.org target=_blank>Godot</a> |
<a href=https://docs.godotengine.org/en/stable/ target=_blank>Godot Docs</a></p><p><a href=https://z-library.sk/ target=_blank>Z-Library</a></p><p><a href=https://docs.kernel.org/ target=_blank>Linux Kernel Docs</a></p><p><a href=https://www.gnu.org/ target=_blank>GNU</a></p><a href=https://archlinux.org/ target=_blank>ArchLinux</a><p><a href=https://help.ubuntu.com/ target=_blank>Ubuntu Doc</a> |
<a href=https://ubuntu.com/server/docs target=_blank>Ubuntu Server Guide</a></p><p><a href=https://www.vulkan.org/ target=_blank>Vulkan</a> |
<a href=https://docs.vulkan.org/ target=_blank>Vulkan Docs</a></p><p><a href=https://www.opengl.org/ target=_blank>OpenGL</a> |
<a href=https://registry.khronos.org/OpenGL target=_blank>OpenGL API</a> |
<a href=https://www.khronos.org/opengl/wiki/ target=_blank>OpenGL Wiki</a></p><p><a href=https://learn.microsoft.com/en-us/windows/win32/directx target=_blank>DirectX</a></p><p><a href=https://www.realtimerendering.com/ target=_blank>Real-Time Rendering</a></p><p><a href=https://www.pbr-book.org/ target=_blank>Physically Based Rendering</a></p><p><a href=https://www.scratchapixel.com/ target=_blank>Scratchapixel</a></p><p><a href=https://learnopengl.com/ target=_blank>LearnOpenGL</a></p><p><a href=https://raytracing.github.io/ target=_blank>Ray Tracing in One Weekend</a></p><p><a href=https://www.shadertoy.com/ target=_blank>Shadertoy</a></p><p><a href=https://arxiv.org/list/cs.GR/recent target=_blank>arXiv Graphics</a></p><p><a href=https://www.siggraph.org/ target=_blank>SIGGRAPH</a> |
<a href=https://dl.acm.org/conference/siggraph target=_blank>SIGGRAPH Digital Library</a></p><p><a href=https://git-scm.com/ target=_blank>Git</a> |
<a href=https://git-scm.com/doc target=_blank>Docs</a> |
<a href=https://git-scm.com/community target=_blank>Community</a></p></div></div></div><script src=/js/ref-window.js></script><article class=single_article><div class=title>Subtree<div class=meta>Modified: 2025-12-31
| Author：ljf12825</div></div><div class=content><p>Git子树是一种在Git仓库中嵌套和管理另一个独立Git仓库的方法。它允许你将外部项目的外争代码库（包括其历史记录）作为主项目的一个子项目来管理</p><h2 id=核心概念>核心概念</h2><p>主项目<code>Project-A</code>需要依赖一个第三方库<code>Library-B</code>，有几种选择：</p><ol><li>直接复制粘贴代码：丢失<code>Library-B</code>的所有历史，且难以更新</li><li>使用Git子模块：创建一个链接，但需要仓库使用者额外初始化，增加了复杂性</li><li>使用Git子树：将<code>Library-B</code>的代码和历史记录合并到<code>Project-A</code>的一个子目录（如<code>libs/Library-B</code>）中</li></ol><p>子树的核心思想是第3种。对于主仓库来说，外部仓库的文件就是它自己的文件，存在于一个特定的子目录中</p><h2 id=子树的关键特性>子树的关键特性</h2><ol><li>单一仓库</li></ol><ul><li>使用子树的仓库是一个完整的、独立的仓库</li><li>克隆主项目时，子树的内容会一次性被克隆下来，不需要像子模块那样额外的<code>git submodule update --init</code>步骤</li></ul><ol start=2><li>保留历史</li></ol><ul><li>子树合并会保留外部项目的完整提交历史。你可以在主项目的历史中看到诸如<code>Add 'libs/Library-B' from commit &lt;hash></code>的提交，并且可以<code>git log</code>进入到子目录查看该库原本的提交记录</li></ul><ol start=3><li>管理双向工作流</li></ol><ul><li>单向依赖：如果你只是使用一个第三方库（如jQuery），并且不打算修改它，子树可以很方便地让你拉取上游的更新</li><li>双向贡献：如果你既要在主项目中使用这个库，又需要对这个库本身进行修改并贡献回原始项目，子树也能通过<code>subtree push</code>命令支持</li></ul><h2 id=read-tree>read-tree</h2><p><code>git read-tree</code>是一个plumbing命令，意味“管道”命令，是为脚本和其他Git命令提供基础操作的底层命令。普通用户在日常使用中很少调用它</p><p>它的核心功能是：将指定的树对象（Tree Object）读取到Git的暂存区（Index），替换或合并当前暂存区的内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 将某次提交的树读入暂存区，覆盖当前暂存区</span>
</span></span><span style=display:flex><span>git read-tree &lt;commit-hash&gt;
</span></span></code></pre></div><p>执行后，<code>git status</code>会显示工作区文件和暂存区之间的大量差异，因为暂存区已经被替换成了那个提交的状态</p><p><code>read-tree</code>有几个重要的选项，与子树相关</p><ul><li><code>-m</code>：执行合并。它可以将最多三个树对象（共同的祖先、我们的版本、他们的版本）合并到暂存区</li><li><code>--prefix=&lt;path></code>：这是关键。这个选项允许你将读取的树对象不是放在暂存区的根目录，而是放在一个指定的子目录下</li></ul><h3 id=示例手动实现引入一个外部项目的例子>示例：手动实现“引入一个外部项目”的例子</h3><p>假设你想把B作为子目录<code>vendor/project-b</code>放入项目A中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 在项目A的仓库中</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 1. 将项目B的远程仓库添加为一个远程源</span>
</span></span><span style=display:flex><span>git remote add project-b &lt;url-to-project-b&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 2. 获取项目B的所有数据</span>
</span></span><span style=display:flex><span>git fetch project-b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 3. 使用 read-tree 将项目B的main分支的树，读入暂存区的 `vendor/project-b/`目录下</span>
</span></span><span style=display:flex><span>git read-tree --prefix<span style=color:#ff79c6>=</span>vendor/profect-b/ -u project-b/main 
</span></span></code></pre></div><ul><li><code>--prefix=vendor/project-b/</code>：告诉Git,把project-b/main的文件树放到这个子目录里</li><li><code>-u</code>：选项让<code>read-tree</code>同时更新工作区，所以你会在文件系统中立刻看到<code>vendor/project-b/</code>目录以及其里面的文件</li><li>执行完后，暂存区已经准备好了这次更新，你只需要执行<code>git commit</code>即可</li></ul><p>这就是<code>git read-tree</code>在“子树”操作中扮演的角色：它负责将另一个仓库的完整文件树“嫁接”到当前仓库的一个子目录中</p><h2 id=subtree>subtree</h2><p><code>git subtree</code>是一个porcelain命令，意为“瓷器”命令，是面向用户的、更友好的高级命令。它是一个脚本，封装了包括<code>git read-tree</code>在内的一系列底层操作，让子树管理工作变得非常简单<br>它解决了手动使用<code>read-tree</code>时的一些复杂问题，比如：</p><ul><li>历史记录的合并：如何保持子目录的历史记录</li><li>代码的推送和拉取：如何将子目录的更改推回其原始仓库</li></ul><h3 id=git-subtree的核心子命令><code>git subtree</code>的核心子命令</h3><ul><li><code>git subtree add</code><ul><li>功能：将一个仓库作为子目录加入当前项目</li><li>底层：它内部会调用类似<code>git read-tree --prefix=...</code>的命令</li><li>示例</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git subtree add --prefix<span style=color:#ff79c6>=</span>vendor/project-b &lt;url-to-project-b&gt; main --squash 
</span></span></code></pre></div><ul><li><p>这会将project-b的<code>main</code>分支合并到本地的<code>vendor/project-b</code>目录</p></li><li><p><code>--squash</code>选项会将子项目的所有历史合并为一次提交，保持主项目历史的整洁；如果想保留历史，去掉此项</p></li><li><p><code>git subtree pull</code></p><ul><li>功能：像<code>git pull</code>一样，更新子目录的内容</li><li>示例</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git subtree pull --prefix<span style=color:#ff79c6>=</span>vendor/project-b &lt;url-to-project-b&gt; main --squash
</span></span></code></pre></div><ul><li><code>git subtree push</code><ul><li>功能：将你的子目录所做的更改推回其原始仓库</li><li>示例</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git subtree push --prefix<span style=color:#ff79c6>=</span>vendor/project-b &lt;url-to-project-b&gt; feature-branch 
</span></span></code></pre></div><table><thead><tr><th>特性</th><th><code>git read-tree</code>（底层）</th><th><code>git subtree</code>（高层）</th></tr></thead><tbody><tr><td>角色</td><td>底层构建块</td><td>用户友好的工具</td></tr><tr><td>用途</td><td>直接操作暂存区中的树</td><td>管理项目中的子项目依赖</td></tr><tr><td>复杂性</td><td>高、需要理解Git内部原理</td><td>低、命令直观易用</td></tr><tr><td>历史管理</td><td>需要手动处理、可能很复杂</td><td>自动处理，可以保持或压扁历史</td></tr><tr><td>工作流</td><td>常用于脚本或自定义合并策略</td><td>用于日常的子项目更新和同步</td></tr></tbody></table><h2 id=子树的优缺点>子树的优缺点</h2><p>优点</p><ul><li>简化工作流：对于仓库使用者来说是透明的，他们看到的是一个完整的项目</li><li>兼容性好：不需要任何特殊的Git配置或版本，也适用于任何支持Git的托管平台（如GitHub, GitLab）</li><li>统一管理：所有代码（自己和依赖的）都在一个仓库里，便于分支、标签和发布管理</li></ul><p>缺点</p><ul><li>仓库体积增大：因为将外部项目的历史合并进来，所以主仓库的体积会变大</li><li>历史可能变得复杂：如果不使用<code>--squash</code>，主项目的提交历史会混入大量外部项目的提交记录，可能影响可读性</li><li>推送更改稍显复杂：向原始项目推送修改需要使用<code>git subtree push</code>，这个命令有时会比较慢，且需要小心处理冲突</li></ul><h2 id=历史融合>历史融合</h2><p>当执行<code>git subtree add</code>时，Git的底层机制是</p><ol><li>读取子树仓库的完整对象历史到你的主仓库的对象数据库中</li><li>将子树的历史与主仓库历史合并</li><li>在指定前缀（子目录）下创建文件树</li></ol><blockquote><p>子仓库的<code>.git</code>内容被“消化吸收”进了主仓库的<code>.git</code>目录中，而不是作为一个独立的<code>.git</code>文件夹存在</p></blockquote><h3 id=底层原理>底层原理</h3><p>Git通过树对象来管理目录结构。执行<code>git subtree add</code>后</p><ol><li>子仓库的所有blob（文件内容）和tree（目录结构）对象被导入主仓库的objects数据库</li><li>在主仓库中创建一个新的commit,将子仓库的树对象链接到指定的前缀路径下</li><li>所有这些对象都存储在同一个<code>.git/objects</code>目录中</li></ol><h2 id=subtree-vs-submodule>Subtree vs Submodule</h2><table><thead><tr><th>特性</th><th>子树</th><th>子模块</th></tr></thead><tbody><tr><td>克隆难度</td><td>简单，<code>git clone</code>一次完成</td><td>需要<code>git submodule update --init</code></td></tr><tr><td>仓库大小</td><td>较大（包含所有依赖的历史）</td><td>较小（只存储连接）</td></tr><tr><td>历史记录</td><td>合并到主仓库历史中</td><td>完全独立于主仓库</td></tr><tr><td>更新依赖</td><td>需要显示地<code>git subtree pull</code></td><td>需要显示地<code>git submodule update</code></td></tr><tr><td>修改依赖</td><td>直接在主项目中修改</td><td>需要进入子模块目录修改并提交</td></tr><tr><td>适用场景</td><td>依赖关系紧密，经常共同修改</td><td>依赖关系松散，希望严格锁定版本</td></tr></tbody></table></div><nav class=post-nav><a href=/unixlike/log/submodule/ class=hover:underline>pre: Submodule</a>
<a href=/unixlike/log/svn/ class=hover:underline>next: svn</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><ul><li><a href=#核心概念>核心概念</a></li><li><a href=#子树的关键特性>子树的关键特性</a></li><li><a href=#read-tree>read-tree</a><ul><li><a href=#示例手动实现引入一个外部项目的例子>示例：手动实现“引入一个外部项目”的例子</a></li></ul></li><li><a href=#subtree>subtree</a><ul><li><a href=#git-subtree的核心子命令><code>git subtree</code>的核心子命令</a></li></ul></li><li><a href=#子树的优缺点>子树的优缺点</a></li><li><a href=#历史融合>历史融合</a><ul><li><a href=#底层原理>底层原理</a></li></ul></li><li><a href=#subtree-vs-submodule>Subtree vs Submodule</a></li></ul></li></ul></nav></aside><script src=/js/scrollspy.js defer></script><script type=module>
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ 
    startOnLoad: true, theme: "default" });
</script><footer><div class=container><p>© 2026 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSES.md>Full License</a></p></div></footer></body></html>