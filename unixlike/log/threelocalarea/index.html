<!doctype html><html lang=en><head><meta name=page-kind content="page"><meta charset=UTF-8><title>Three Local Area</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-ini.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=stylesheet href=/css/logsingle.css></head><body><header class=site-header><div class=container><div class=terminal-overlay aria-label=terminal-prompt><span id=typed-line></span><span class=cursor>█</span></div></div></header><nav class=topnav><div class=container><ul><li><a href=/unixlike/>★</a></li><li><a href=/unixlike/lab/>Lab</a></li><li><a href=/unixlike/log/>Log</a></li><li><a href=/unixlike/file/>File</a></li></ul></div></nav><nav id=star-nav><div id=star-header><span class="title open">>> >> >> Navigation &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Nav>>>>>></span></div><pre class=ascii>
+——————————————————————————————————————————————————————————————+
|                        <a class=nav-item data-path=/rightbrain/ href=/rightbrain/>RightBrain</a>                            |
|                             |                                |
|                             |     <a class=nav-item data-path=/dotnetandwindows/ href=/dotnetandwindows/>.NET-Windows</a>               |
|                             |    /                           |
|                             |   /                            |
|                             |  /                             |
|                             | /                              |
|                             |/                               |
|      <a class=nav-item data-path=/graphic/ href=/graphic/>Graphic</a> ———————————— <a class=nav-item data-path=/home/ href=/home/>Home</a> ————————————— <a class=nav-item data-path=/runtime/ href=/runtime/>Runtime</a>         |
|                            /|                                |
|                           / |                                |
|                          /  |                                |
|                         /   |       <a class=nav-item data-path=/language/ href=/language/>Language</a>                 |
|                        /    |      /                         |
|                       /     |     /                          |
|              <a class=nav-item data-path=/unixlike/ href=/unixlike/>Unix-like</a>      |    /           <a class=nav-item data-path=/project/ href=/project/>Project</a>         |
|                             |   /            <a class=nav-item data-path=/miscellaneous/ href=/miscellaneous/>Miscellaneous</a>   |
|                        <a class=nav-item data-path=/leftbrain/ href=/leftbrain/>LeftBrain</a>             <a class=nav-item data-path=/ai/ href=/ai/>AI</a>              |
+——————————————————————————————————————————————————————————————+
    </pre></nav><script defer src=/js/star-nav.js></script><script defer src=/js/site.js></script><script defer src=/js/star-active.js></script><div id=ref-window class="float-window open"><div class=float-header><span class="title open">>> >> >> Reference &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Ref>>>>>></span></div><div class=float-body><div class=ref-list><a href=https://www.mixamo.com/ target=_blank>Mixamo</a> |
<a href=https://opengameart.org/ target=_blank>OpenGameArt</a><p><a href=https://sharplab.io/ target=_blank>SharpLab</a> |
<a href=https://godbolt.org/ target=_blank>Compiler Explorer</a></p><p><a href="https://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type+Something+&x=none&v=4&h=4&w=80&we=false" target=_blank>ASCII Graph Generator</a></p><p><a href=https://mermaid.js.org/ target=_blank>Mermaid</a></p><a href=https://www.vim.org/ target=_blank>Vim</a> | <a href=https://vimdoc.sourceforge.net/ target=_blank>Vim Manual Source</a> |
<a href=https://vimcdoc.sourceforge.net/ target=_blank>Vimcdoc</a> | <a href=https://vimcdoc.sourceforge.net/doc/help.html target=_blank>Vimdoc read online</a><p><a href=https://shields.io/ target=_blank>Shields.io</a></p><p><a href=https://emojidb.org/ target=_blank>EmojiDB</a></p><p><a href=https://cppreference.com/ target=_blank>cppreference</a></p><p><a href=https://gcc.gnu.org/onlinedocs/ target=_blank>GCC Docs</a></p><p><a href=https://clang.llvm.org/docs/ target=_blank>Clang Docs</a></p><p><a href=https://www.boost.org/libraries/ target=_blank>Boost Library Docs</a></p><p><a href=https://learn.microsoft.com/en-us/dotnet/csharp/ target=_blank>Microsoft Learn</a><p><a href=https://www.lua.org/manual/5.4/ target=_blank>Lua 5.4 Reference Manual</a><p><a href=https://docs.unity3d.com/Manual/index.html target=_blank>Unity Manual</a> |
<a href=https://docs.unity3d.com/ScriptReference/index.html target=_blank>Unity API</a></p><p><a href=https://docs.unrealengine.com/ target=_blank>Unreal Engine Docs</a></p><p><a href=https://godotengine.org target=_blank>Godot</a> |
<a href=https://docs.godotengine.org/en/stable/ target=_blank>Godot Docs</a></p><p><a href=https://z-library.sk/ target=_blank>Z-Library</a> : eBook Library</p><p><a href=https://docs.kernel.org/ target=_blank>Linux Kernel Docs</a></p><p><a href=https://www.gnu.org/ target=_blank>GNU</a> : manuals, philosophy, FAQ</p><a href=https://archlinux.org/ target=_blank>ArchLinux</a><p><a href=https://help.ubuntu.com/ target=_blank>Ubuntu Doc</a> |
<a href=https://ubuntu.com/server/docs target=_blank>Ubuntu Server Guide</a></p><p><a href=https://www.vulkan.org/ target=_blank>Vulkan</a> |
<a href=https://docs.vulkan.org/ target=_blank>Vulkan Docs</a></p><p><a href=https://www.opengl.org/ target=_blank>OpenGL</a> |
<a href=https://registry.khronos.org/OpenGL target=_blank>OpenGL API</a> |
<a href=https://www.khronos.org/opengl/wiki/ target=_blank>OpenGL Wiki</a></p><p><a href=https://learn.microsoft.com/en-us/windows/win32/directx target=_blank>DirectX</a></p><p><a href=https://www.realtimerendering.com/ target=_blank>Real-Time Rendering</a></p><p><a href=https://www.pbr-book.org/ target=_blank>Physically Based Rendering</a></p><p><a href=https://www.scratchapixel.com/ target=_blank>Scratchapixel</a></p><p><a href=https://learnopengl.com/ target=_blank>LearnOpenGL</a></p><p><a href=https://raytracing.github.io/ target=_blank>Ray Tracing in One Weekend</a></p><p><a href=https://www.shadertoy.com/ target=_blank>Shadertoy</a></p><p><a href=https://arxiv.org/list/cs.GR/recent target=_blank>arXiv Graphics</a></p><p><a href=https://www.siggraph.org/ target=_blank>SIGGRAPH</a> |
<a href=https://dl.acm.org/conference/siggraph target=_blank>SIGGRAPH Digital Library</a></p><p><a href=https://git-scm.com/ target=_blank>Git</a> |
<a href=https://git-scm.com/doc target=_blank>Docs</a> |
<a href=https://git-scm.com/community target=_blank>Community</a></p></div></div></div><script src=/js/ref-window.js></script><article class=single_article><div class=title>Three Local Area<div class=meta>Modified: 2025-12-31
| Author：ljf12825</div></div><div class=content><h1 id=工作区>工作区</h1><p>工作区就是实际操作的目录，包含项目的所有文件和子目录</p><h2 id=作用>作用</h2><ul><li>直接可见和可编辑的文件</li><li>也成为工作目录或工作副本</li><li>文件状态可能是：未跟踪（untracked）、已修改(modified)和未修改(unmodified)</li></ul><h2 id=常用命令>常用命令</h2><ul><li>直接编辑文件</li><li><code>git status</code>查看文件状态</li><li><code>git add</code>将修改加入暂存区</li><li><code>git restore</code>恢复工作区或暂存区状态</li></ul><h2 id=git-add><code>git add</code></h2><p><code>git add</code>是Git中最基础且重要的命令之一，用于将工作目录中的变更添加到暂存区，为后续提交做准备</p><h3 id=基本语法>基本语法</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add <span style=color:#f92672>[</span>选项<span style=color:#f92672>]</span> &lt;文件/目录/模式&gt;
</span></span></code></pre></div><p><strong>主要用法</strong></p><ol><li>添加单个文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add filename.txt
</span></span></code></pre></div><p>将指定的文件变更添加到暂存区</p><ol start=2><li>添加多个文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add file1.txt file2.js file3.css
</span></span></code></pre></div><p>可以一次性添加多个文件</p><ol start=3><li>添加整个目录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add dirname/
</span></span></code></pre></div><p>添加指定目录下的所有变更（不包括子目录，除非使用递归选项）</p><ol start=4><li>添加当前目录所有变更</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add .
</span></span></code></pre></div><p>添加当前目录及其所有子目录中的所有已追踪文件的变更（不包括未追踪的新文件）</p><ol start=5><li>添加所有变更（包括为未跟踪的文件）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -A
</span></span><span style=display:flex><span><span style=color:#75715e># 或</span>
</span></span><span style=display:flex><span>git add --all
</span></span></code></pre></div><p>添加工作区中所有已跟踪文件的修改和删除，以及所有未跟踪的新文件（不包括<code>.gitignore</code>中指定的文件）</p><ol start=6><li>交互式添加</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -i
</span></span><span style=display:flex><span><span style=color:#75715e># 或</span>
</span></span><span style=display:flex><span>git add -interactive
</span></span></code></pre></div><p>进入交互模式，可以更精细地控制要暂存的变更，在交互模式中，可以选择</p><ul><li>暂存更新</li><li>暂存撤销</li><li>暂存补丁</li><li>暂存差异</li></ul><ol start=7><li>按补丁添加（部分添加）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -p
</span></span><span style=display:flex><span><span style=color:#75715e># 或</span>
</span></span><span style=display:flex><span>git add --patch
</span></span></code></pre></div><p>交互式选择文件中的部分变更进行添加，而不是整个文件，操作提示：</p><ul><li>y：暂存当前块</li><li>n：不暂存当前块</li><li>s：拆分当前块</li><li>e：手动编辑当前块</li></ul><ol start=8><li>添加已跟踪文件的修改（不包括新文件）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -u
</span></span><span style=display:flex><span><span style=color:#75715e># 或</span>
</span></span><span style=display:flex><span>git add --update
</span></span></code></pre></div><p><strong>特殊用法</strong></p><ol><li>使用通配符添加文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add *.js
</span></span></code></pre></div><p>添加所有<code>.js</code>文件</p><ol start=2><li>添加修改和删除的文件，但不包括新文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -u .
</span></span></code></pre></div><ol start=3><li>强制添加被忽略的文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add -f ignored_file.log
</span></span></code></pre></div><h3 id=常用参数>常用参数</h3><table><thead><tr><th>选项</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td><code>-n</code></td><td><code>--dry-run</code></td><td>只显示要添加的文件，不实际执行</td></tr><tr><td><code>-v</code></td><td><code>--verbose</code></td><td>显示详细信息</td></tr><tr><td><code>-f</code></td><td><code>--force</code></td><td>允许添加通常被忽略的文件</td></tr><tr><td><code>-e</code></td><td><code>--edit</code></td><td>手动编辑差异</td></tr><tr><td><code>--ignore-errors</code></td><td></td><td>跳过因错误无法添加的文件</td></tr><tr><td><code>--ignore-missing</code></td><td></td><td>检查文件是否存在</td></tr></tbody></table><h3 id=注意事项>注意事项</h3><ol><li><code>git add</code>不会自动添加<code>.gitignore</code>忽略的文件</li><li>添加后的变更可以通过<code>git reset</code>从暂存区移除</li><li>使用<code>git add -A</code>或<code>git add .</code>时要小心，避免添加不必要的文件</li><li>建议经常使用<code>git status</code>查看添加后的状态变化</li></ol><h2 id=git-restore><code>git restore</code></h2><p><code>git restore</code>是Git2.23版本引入的一个新命令，旨在提供更职官和安全的文件恢复操作，它替代了部分<code>git checkout</code>和<code>git reset</code>功能</p><h3 id=核心功能>核心功能</h3><p><code>git restore</code>主要用于三种场景</p><ol><li>丢弃工作区的修改（恢复到最后一次提交或暂存区状态）</li><li>取消暂存（将文件从暂存区移出）</li><li>从指定提交恢复文件</li></ol><h3 id=基础用法>基础用法</h3><ol><li>丢弃工作区修改（危险操作）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git resotre &lt;file&gt;
</span></span></code></pre></div><ul><li>将工作区文件恢复到暂存区状态（如果已暂存）</li><li>如果没有暂存，则恢复到最近一次提交的状态</li><li>会永久丢失工作区未暂存的修改</li></ul><ol start=2><li>取消暂存（安全操作）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git resotre --staged &lt;file&gt;
</span></span></code></pre></div><ul><li>将文件从暂存区移出</li><li>保留工作区的修改</li><li>相当于旧命令<code>git reset HEAD &lt;file></code></li></ul><ol start=3><li>从特定提交恢复</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git restore --source<span style=color:#f92672>=</span>&lt;commit&gt; &lt;file&gt;
</span></span></code></pre></div><ul><li>从指定提交恢复文件到工作区</li><li>不影响暂存区</li><li>例如：<code>git restore --source=HEAD~2 config.ini</code></li></ul><ol start=4><li>组合操作</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git restore --source<span style=color:#f92672>=</span>HEAD --staged --worktree &lt;file&gt;
</span></span></code></pre></div><ul><li>同时恢复工作区和暂存区</li><li>完全重置文件到最后一次提交状态</li></ul><ol start=5><li>交互式恢复</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git restore --patch &lt;file&gt;
</span></span></code></pre></div><ul><li>交互式选择要恢复的变更块</li><li>类似于<code>git add -p</code>的反向操作</li></ul><ol start=6><li>恢复整个目录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git restore
</span></span></code></pre></div><ul><li>恢复当前目录所有文件</li><li>可结合<code>--staged</code>等选项使用</li></ul><h3 id=注意事项-1>注意事项</h3><ol><li><code>git restore</code>是一个破坏性操作，特别是没有<code>--staged</code>选项时会丢弃工作区修改</li><li>恢复操作不可逆，建议先提交或备份重要更改</li><li>可以使用<code>--dry-run</code>选项先模拟操作结果</li></ol><h1 id=暂存区>暂存区</h1><p>暂存区也称为”索引“（Index）。它是Git工作流程中的一个中间步骤，位于工作目录和版本库之间</p><h2 id=作用-1>作用</h2><ol><li>选择性提交：允许只提交部分修改过的文件，甚至是一个文件中的部分修改</li><li>准备提交内容：将工作目录中的变更收集起来，形成一个逻辑上完整的变更集</li><li>分离修改与提交：可以在提交前审查和整理变更</li></ol><h2 id=特点>特点</h2><ul><li>存储了下次将要提交的文件变更</li><li>允许选择性提交部分</li><li>是Git独有的概念，其他VCS通常没有这一层</li></ul><h2 id=常用命令-1>常用命令</h2><ul><li><code>git add</code>添加文件到暂存区</li><li><code>git reset</code>从暂存区移除文件</li><li><code>git diff --cached</code>查看暂存区与仓库的差异</li></ul><h2 id=原理>原理</h2><ol><li>存储位置：<code>.git/index</code>二进制文件</li><li>内容结构</li></ol><ul><li>文件路径的SHA-1哈希值</li><li>时间戳</li><li>文件大小</li><li>权限信息</li></ul><ol start=3><li>查看原始内容</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git ls-files --stage <span style=color:#75715e># 查看暂存区完整内容</span>
</span></span></code></pre></div><h1 id=git仓库>Git仓库</h1><p>Git仓库是Git存储项目历史记录的地方，包含所有提交的对象</p><h2 id=特点-1>特点</h2><ul><li>存储完整的历史项目</li><li>包含提交（commit）、树(tree)和二进制大对象(blob)</li><li>本地仓库存储在项目目录的<code>.git</code>子目录中</li><li>可以推送到远程仓库与他人共享</li></ul><h2 id=仓库结构>仓库结构</h2><p>Git仓库核心目录结构（.git目录）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>.git/
</span></span><span style=display:flex><span>├── HEAD                  # 当前所在分支的引用
</span></span><span style=display:flex><span>├── config                # 仓库特定的配置
</span></span><span style=display:flex><span>├── description           # 仓库描述（主要用于GitWeb）
</span></span><span style=display:flex><span>├── hooks/                # 客户端和服务端钩子脚本
</span></span><span style=display:flex><span>│   ├── pre-commit.sample    # 提交前钩子示例
</span></span><span style=display:flex><span>│   ├── post-update.sample   # 更新后钩子示例
</span></span><span style=display:flex><span>│   └── ...                 # 其他钩子示例
</span></span><span style=display:flex><span>├── info/                 # 全局排除模式
</span></span><span style=display:flex><span>│   └── exclude           # 本地忽略规则（不共享）
</span></span><span style=display:flex><span>├── objects/              # 所有Git对象数据库
</span></span><span style=display:flex><span>│   ├── info/             # 对象信息
</span></span><span style=display:flex><span>│   └── pack/             # 打包的对象（优化存储）
</span></span><span style=display:flex><span>├── refs/                 # 引用（分支和标签）指针
</span></span><span style=display:flex><span>│   ├── heads/            # 本地分支引用
</span></span><span style=display:flex><span>│   └── tags/             # 标签引用
</span></span><span style=display:flex><span>└── index                 # 暂存区（索引）文件
</span></span></code></pre></div><h3 id=objects-in-git>objects in .git</h3><p>Git的核心是一个简单的键值对数据库（key-value data store），这个数据库主要包含四种基本对象：blob对象、tree对象、commit对象和tag对象。这些对象共同构成了Git版本控制的基础</p><p><strong>git对象的存储机制</strong>
所有Git对象都存储在<code>.git/objects</code>目录下，采用分目录 + 压缩的方式每个对象都有一个40个字符的SHA-1哈希值作为唯一标识</p><ul><li>前两个字符作为目录名，后38个字符作为文件名</li><li>内容是zlib压缩的</li><li>每个对象在压缩前的格式是</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;type&gt; &lt;size&gt;\0&lt;content&gt;
</span></span></code></pre></div><p>这是Git计算SHA-1哈希的原始数据格式</p><ul><li>Git对象是不可变的，如果内容相同（包括元数据），对象哈希就相同，不会重复存储</li><li>新对象会先存在<code>.git/objects/</code>目录中（松散对象），多了之后，Git会用<code>git gc</code>打包成<code>.pack</code>文件以节省空间，并生成<code>.idx</code>索引</li><li>分支本质上是<code>.git/refs/heads/</code>下的一个指针文件，里面存一个commit SHA</li><li><code>HEAD</code>通常指向某个分支（间接引用），也可以直接指向某个commit（游离状态）</li></ul><h4 id=四种对象类型>四种对象类型</h4><ol><li>Bolb对象（二进制大对象）</li></ol><ul><li>作用：存储文件内容</li><li>特点：<ul><li>只保存文件内容，不保存文件名、权限等元数据</li><li>相同内容只会存储依次（节省空间）</li><li>通过<code>git hash-object</code>命令创建</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#960050;background-color:#1e0010>&#39;</span>test content<span style=color:#e6db74>`</span> | git hash-object -w --stdin
</span></span></code></pre></div><ul><li>用命令查看</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git hash-object hello.txt <span style=color:#75715e># 计算文件哈希值</span>
</span></span><span style=display:flex><span>git cat-file -p &lt;blob_sha&gt; <span style=color:#75715e># 查看 blob内容</span>
</span></span></code></pre></div></li></ul><ol start=2><li>Tree对象（树对象）</li></ol><ul><li>作用：代表目录结构，记录文件名和目录结构</li><li>特点：<ul><li>包含一组指向blob对象或其他tree对象的指针</li><li>每条记录包含：文件模式、对象类型、SHA-1哈希值和文件名</li><li>通过<code>git write-tree</code>命令创建</li><li>类似一个“目录快照”</li><li>查看</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git ls-tree &lt;tree_sha&gt;
</span></span></code></pre></div></li></ul><ol start=3><li>Commit</li></ol><ul><li>代表一次提交</li><li>保存的信息包括<ul><li>指向一个tree（即此提交的根目录快照）</li><li>父提交（parent）</li><li>作者（author）和提交者（committer）</li><li>提交说明（message）</li></ul></li><li>查看</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git cat-file -p &lt;commit_sha&gt;
</span></span></code></pre></div><ol start=4><li>Tag</li></ol><ul><li>给commit打标签，可以是轻量标签或附注标签</li><li>附注标签本身也是Git对象，包含tag创建者、时间、描述等信息</li><li>查看</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git cat-file -p &lt;tag_sha&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-rust data-lang=rust><span style=display:flex><span>commit <span style=color:#f92672>---</span>-&gt; <span style=color:#a6e22e>tree</span> <span style=color:#f92672>---</span>-&gt; <span style=color:#a6e22e>blob</span> (<span style=color:#960050;background-color:#1e0010>文件内容</span>)
</span></span><span style=display:flex><span>           <span style=color:#960050;background-color:#1e0010>└</span><span style=color:#f92672>---</span>-&gt; <span style=color:#a6e22e>tree</span> <span style=color:#f92672>---</span>-&gt; <span style=color:#a6e22e>blob</span>
</span></span><span style=display:flex><span>tag <span style=color:#f92672>-----</span>-&gt; <span style=color:#a6e22e>commit</span>
</span></span></code></pre></div><p>commit只认它的顶级Tree
tag是commit的别名，方便引用</p><h4 id=总结>总结</h4><p>Git对象的层级关系</p><ol><li>Blob和Tree</li></ol><ul><li>Tree是目录对象，像一个文件夹</li><li>Tree的节点可以是：<ul><li>Blob（文件内容对象）</li><li>另一个Tree（子目录）</li></ul></li><li>所以，Blob和Tree都是Tree的子节点，但Blob永远是叶子节点，Tree可以继续分支</li></ul><ol start=2><li>Commit</li></ol><ul><li>Commit并不是直接保存文件内容，而是保存一个Tree的哈希</li><li>这个Tree是该次提交的项目根目录快照</li><li>Commit还会记录：<ul><li>父commit（形成历史链）</li><li>作者、时间、提交信息</li><li>所以，Commit相当于一个“版本标签”，指向一个完整的目录快照（Tree）</li></ul></li></ul><ol start=3><li>Tag</li></ol><ul><li>Tag是对一个对象的引用（最常见的是指向Commit）</li><li>Tag也可能指向Blob或Tree，但通常没有意义，其几乎不用</li><li>附注标签本身是一个Git对象，记录标签作者、时间、说明，并包含一个指向目标对象（通常是Commit）的指针</li></ul><h2 id=常用命令-2>常用命令</h2><ul><li><code>git commit</code>：将暂存区内容提交到仓库</li><li><code>git show &lt;commit></code> 查看特定提交的详细信息</li><li><code>git log</code>：查看提交了历史</li><li><code>git push</code>：推送到远程仓库</li><li><code>git init</code>：初始化新仓库</li><li><code>git clone</code>：克隆远程仓库</li><li><code>git gc</code>：垃圾回收优化仓库</li><li><code>git prune</code>：删除孤立对象</li><li><code>git repack</code>：重新打包松散对象</li><li><code>git fsck</code>：检查仓库完整性</li><li><code>git reflog</code>：查看所有历史操作（救命命令）</li><li><code>git filter-branch</code>：批量修改历史</li><li><code>git archive</code>：归档</li><li><code>git replace</code>：在引用图中替换某个对象的指针</li></ul><h2 id=git-commit><code>git commit</code></h2><p><code>git commit</code>的作用是将staging area中的内容作为一个新的提交保存到Git仓库中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;提交信息&#34;</span>
</span></span></code></pre></div><p>这会</p><ol><li>将暂存区的内容创建一个新的提交</li><li>使用指定的提交信息记录这次变更</li><li>更新当前分支指向这个新提交</li></ol><h3 id=常用参数-1>常用参数</h3><ol><li>修改提交信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit --amend
</span></span></code></pre></div><p>这会</p><ul><li>打开编辑器修改最后一次提交的提交信息</li><li>或者与<code>-m</code>一起使用直接指定新信息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit --amend -m <span style=color:#e6db74>&#34;新的提交信息&#34;</span>
</span></span></code></pre></div><ol start=2><li>添加变更到上次提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit --amend --no-edit
</span></span></code></pre></div><p>这会</p><ul><li>将当前暂存区的变更添加到上次提交中</li><li>保持原有的提交信息不变</li></ul><ol start=3><li>跳过暂存区直接提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -a -m <span style=color:#e6db74>&#34;提交信息&#34;</span>
</span></span></code></pre></div><p>或</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -am <span style=color:#e6db74>&#34;提交信息&#34;</span>
</span></span></code></pre></div><p>这会：</p><ul><li>自动暂存所有已跟踪文件的变更</li><li>然后创建提交（相当于<code>git add -u</code> + <code>git commit</code> ）</li></ul><ol start=4><li>部分文件提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git add file1.txt file2.txt
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;部分提交&#34;</span>
</span></span></code></pre></div><ol start=5><li>空提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit --allow-empty -m <span style=color:#e6db74>&#34;空提交&#34;</span>
</span></span></code></pre></div><p>用于触发CI</p><ol start=6><li>指定作者信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;提交信息&#34;</span> --author<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;名字 &lt;emali&gt;&#34;</span>
</span></span></code></pre></div><ol start=7><li>指定日期</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;提交信息&#34;</span> --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2023-01-01T12:00:00&#34;</span>
</span></span></code></pre></div><h3 id=最佳实践>最佳实践</h3><ol><li>原子性提交：每个提交只做一件事</li><li>频繁提交：小步提交比大变更更好</li><li>描述性信息：清楚地说明为什么变更，而不仅是做了什么</li><li>验证提交：提交前使用<code>git dirr --cached</code>检查</li></ol><h2 id=git-show><code>git show</code></h2><p><code>git show</code>是Git中用于显示各种Git对象（如提交、标签、树和blob）详细信息的强大命令</p><h3 id=基本用法>基本用法</h3><ol><li>显示最新提交的详细信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show
</span></span></code></pre></div><p>这会显示最近一次提交的：</p><ul><li>提交哈希</li><li>作者信息</li><li>提交日期</li><li>提交信息</li><li>变更内容（diff）</li></ul><ol start=2><li>显示特定提交的详情</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;commit-hash&gt;
</span></span></code></pre></div><ol start=3><li>显示标签对应的提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;tag-name&gt;
</span></span></code></pre></div><ol start=4><li>仅显示提交信息（不显示diff）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show --stat &lt;commit&gt;
</span></span></code></pre></div><p>这会显示</p><ul><li>提交元数据</li><li>更改的文件统计（那哪些文件被修改，增减行数></li></ul><ol start=5><li>显示特定文件的变更</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;commit&gt;:&lt;file-path&gt;
</span></span></code></pre></div><ol start=6><li>简洁格式显示</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show --oneline &lt;commit&gt;
</span></span></code></pre></div><ol start=7><li>显示原始差异（raw diff）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show --raw &lt;commit&gt;
</span></span></code></pre></div><ol start=8><li>显示特定作者提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;commit&gt; --author<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;John&#34;</span>
</span></span></code></pre></div><ol start=9><li>比较两次提交间的差异</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;commit1&gt;..&lt;commit2&gt;
</span></span></code></pre></div><ol start=10><li>显示合并提交的父提交差异</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show -m &lt;merge-commit&gt;
</span></span></code></pre></div><ol start=11><li>显示文件在特定提交时的内容</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show &lt;commit&gt;:&lt;path/to/file&gt;
</span></span></code></pre></div><ol start=12><li>显示提交引入的补丁</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show -p &lt;commit&gt;
</span></span></code></pre></div><ol start=13><li>输出格式控制
自定义格式</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show --pretty<span style=color:#f92672>=</span>format:<span style=color:#e6db74>&#34;%h - %an, %ar : %s&#34;</span> &lt;commit&gt;
</span></span></code></pre></div><p>常用格式占为符</p><ul><li><code>%H</code>：完整提交哈希</li><li><code>%h</code>：简短提交哈希</li><li><code>%an</code>：作者名字</li><li><code>%ar</code>：相对作者日期</li><li><code>%s</code>：提交信息主题</li></ul><p>JSON格式输出</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git show --pretty<span style=color:#f92672>=</span>format:<span style=color:#e6db74>&#39;{%n  &#34;commit&#34;: &#34;%H&#34;,%n  &#34;author&#34;: &#34;%an&#34;,%n  &#34;date&#34;: &#34;%ad&#34;,%n  &#34;message&#34;: &#34;%s&#34;%n}&#39;</span> -s &lt;commit&gt;
</span></span></code></pre></div><h2 id=git-init><code>git init</code></h2><p><code>git init</code>是初始化命令，用于创建一个新的Git仓库</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git init
</span></span></code></pre></div><p>这会在当前目录创建一个新的Git仓库，生成一个隐藏的<code>.git</code>目录，包含所有必要的Git元数据</p><h3 id=常用选项>常用选项</h3><ol><li>指定目录名称</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git init &lt;目录名&gt;
</span></span></code></pre></div><p>这会：</p><ul><li>创建指定名称的目录</li><li>在该目录中初始化Git仓库</li></ul><ol start=2><li>创建裸仓库</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git init --bare
</span></span></code></pre></div><p>裸仓库特点：</p><ul><li>没有工作目录</li><li>专门用于共享/协作</li><li>通常用于中央仓库或服务器</li></ul><ol start=3><li>指定初始分支名称</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git init -b &lt;分支名&gt;
</span></span></code></pre></div><h3 id=注意事项-2>注意事项</h3><ol><li>在已有Git仓库中再次运行<code>git init</code>是安全的，不会覆盖已有内容</li><li>Git2.28+版本开始，默认初始分支可以通过配置修改</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global init.defaultBranch main
</span></span></code></pre></div><ol start=3><li>初始化后需要至少一个提交才会真正创建分支</li></ol><h2 id=git-clone><code>git clone</code></h2><p><code>git clone</code>用于将远程仓库完整地复制到本地</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone &lt;仓库URL&gt; <span style=color:#f92672>[</span>目录名<span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=核心功能-1>核心功能</h3><ol><li>完整复制远程仓库：包括所有历史记录、分支和配置</li><li>自动设置远程追踪：默认创建名为<code>origin</code>的远程连接</li><li>检出工作副本：自动检出默认分支（通常是<code>main</code>或<code>master</code>）</li></ol><h3 id=常用用法>常用用法</h3><ol><li>基本克隆</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone &lt;repoURL&gt;
</span></span></code></pre></div><ol start=2><li>克隆到指定目录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone &lt;repoURL&gt; <span style=color:#f92672>[</span>目录名<span style=color:#f92672>]</span>
</span></span></code></pre></div><ol start=3><li>克隆时指定分支</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone -b branch_name &lt;repoURL&gt;
</span></span></code></pre></div><ol start=4><li>克隆深度克隆（只获取最近历史）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --depth <span style=color:#ae81ff>1</span> &lt;repoURL&gt;
</span></span></code></pre></div><ol start=5><li>克隆裸仓库</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --bare &lt;repoURL&gt;
</span></span></code></pre></div><ol start=6><li>克隆时排除某些历史</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --filter<span style=color:#f92672>=</span>blob:none &lt;repoURL&gt;
</span></span></code></pre></div><ol start=7><li>克隆子模块（递归克隆）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --recursive &lt;repoURL&gt;
</span></span></code></pre></div><ol start=8><li>克隆时指定配置</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone -c core.autocrlf<span style=color:#f92672>=</span>input &lt;repoURL&gt;
</span></span></code></pre></div><h3 id=支持的协议>支持的协议</h3><p><code>git clone</code>支持多种协议</p><ul><li>HTTPS：<code>https://github.com/user/repo.git</code></li><li>SSH：<code>git@github.com:user/repo.git</code></li><li>Git：<code>git://github.com/user/repo.git</code></li><li>本地路径：<code>/path/to/repo</code> 或 <code>file:///path/to/repo</code></li></ul><h3 id=注意事项-3>注意事项</h3><ol><li>克隆大型仓库可能需要较长时间和足够的磁盘空间</li><li>私有仓库需要配置正确的认证方式</li><li>默认只克隆默认分支，其他分支需要通过<code>git checkout</code>获取</li><li>克隆后会自动设置远程跟踪分支，可以直接使用<code>git pull</code>更新</li></ol><h2 id=git-gc><code>git gc</code></h2><p><code>git gc</code>（Garbage Collection）是Git的垃圾回收命令，用于优化本地仓库性能并清理不必要的文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git gc
</span></span></code></pre></div><p>核心功能</p><ol><li>清理松散对象：删除不再被引用的对象（commit，tree，blob等）</li><li>压缩对象：将多个松散对象打包成更高效的<code>.pack</code>文件</li><li>优化仓库结构：重组Git内部数据结构提高性能</li><li>修剪过时引用：清理陈旧的reflog条目</li></ol><h3 id=常用选项-1>常用选项</h3><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>--aggressive</code></td><td>更彻底的优化（耗时更长）</td></tr><tr><td><code>--auto</code></td><td>只在必要时执行（Git自动调用时使用）</td></tr><tr><td><code>--prune=&lt;date></code></td><td>删除指定日期前的松散对象（如<code>--prune=now</code>）</td></tr><tr><td><code>--no-prune</code></td><td>不删除任何松散对象</td></tr><tr><td><code>--quiet</code></td><td>静默模式，减少输出</td></tr></tbody></table><h3 id=执行时机>执行时机</h3><p>Git会在以下情况自动执行<code>gc</code></p><ul><li>创建太多松散对象时</li><li>执行某些命令时（如<code>git push</code>）</li><li>达到配置的阈值时</li></ul><p><strong>手动执行场景</strong></p><ol><li>仓库体积异常增大时</li><li>Git操作变慢时</li><li>大量提交后准备归档时</li><li>长时间使用的仓库定期维护</li></ol><h3 id=配置参数>配置参数</h3><p>可通过<code>git config</code>调整GC行为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 自动设置GC的松散对象阈值</span>
</span></span><span style=display:flex><span>git config gc.auto <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置自动打包的对象阈值</span>
</span></span><span style=display:flex><span>git config gc.autoPackLimit <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置prune过期时间（默认两周）</span>
</span></span><span style=display:flex><span>git config gc.pruneExpire <span style=color:#e6db74>&#34;1 month ago&#34;</span>
</span></span></code></pre></div><h3 id=git-prune><code>git prune</code></h3><p><code>git prune</code>是Git中用于清理不可达对象的底层命令，通常被<code>git gc</code>自动调用，但在某些特殊情况下需要手动调用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git prune <span style=color:#f92672>[</span>-n<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>-v<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--expire &lt;time&gt;<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>&lt;head&gt;...<span style=color:#f92672>]</span>
</span></span></code></pre></div><h4 id=核心功能-2>核心功能</h4><ol><li>删除孤立对象：清理没有被任何引用（分支、标签、reflog等）指向的Git对象</li><li>回收存储空间：减少<code>.git/objects</code>目录的大小</li><li>维护仓库健康：移除无用数据，优化仓库性能</li></ol><h4 id=常用选项-2>常用选项</h4><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>-n</code>/<code>--dry-run</code></td><td>只显示将要删除的对象，不实际执行</td></tr><tr><td><code>-v-/</code>&ndash;verbose`</td><td>显示详细处理信息</td></tr><tr><td><code>--expire &lt;time></code></td><td>只删除早于指定时间的对象（如<code>--expire=now</code>）</td></tr><tr><td><code>--progress</code></td><td>显示进度条</td></tr></tbody></table><h4 id=工作原理>工作原理</h4><ol><li>扫描<code>.git/objects</code>目录中的所有对象</li><li>检查每个对象是否被以下引用</li></ol><ul><li>分支和标签</li><li>reflog记录</li><li>其他对象引用</li></ul><ol start=3><li>删除所有未被引用的对象</li></ol><h4 id=注意事项-4>注意事项</h4><ol><li>危险操作：删除的对象无法恢复，确保没有重要数据未被引用</li><li>通常不需要手动执行：<code>git gc</code>会自动调用<code>prune</code></li><li>可能影响悬空提交：会清理违背引用但可能有价值的提交</li><li>大型仓库耗时：对象多的仓库可能需要较长时间</li></ol><h3 id=git-repack><code>git repack</code></h3><p><code>git gc</code>的子操作，<code>git repack</code>是Git中用于优化仓库存储结构的底层命令，它会将多个松散对象（loose objects）重新打包成更高效的pack文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git repack <span style=color:#f92672>[</span>选项<span style=color:#f92672>]</span>
</span></span></code></pre></div><h4 id=核心功能-3>核心功能</h4><ol><li>将松散对象打包：将<code>.git/objects</code>中的单个文件对象合并为pack文件</li><li>删除冗余对象：移除重复的或未被引用的对象</li><li>优化存储：通过delta压缩减少仓库体积</li><li>提高性能：减少Git操作时需要访问的文件数量</li></ol><h4 id=常用选项-3>常用选项</h4><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>-a</code></td><td>打包所有松散对象（包括未被引用的）</td></tr><tr><td><code>-d</code></td><td>打包后删除冗余的松散对象</td></tr><tr><td><code>-f</code></td><td>强制重新打包已有pack文件</td></tr><tr><td><code>-l</code></td><td>保留旧的pack文件（安全选项）</td></tr><tr><td><code>-n</code></td><td>只显示将要执行的操作，不实际运行</td></tr><tr><td><code>--window=&lt;n></code></td><td>设置delta压缩窗口大小（默认10）</td></tr><tr><td><code>--depth=&lt;n></code></td><td>设置delta压缩的深度（默认50）</td></tr><tr><td><code>--threads=&lt;n></code></td><td>设置打包使用的线程数</td></tr></tbody></table><h4 id=配置参数-1>配置参数</h4><p>可通过<code>git config</code>调整repack行为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 设置 delta压缩窗口大小</span>
</span></span><span style=display:flex><span>git config repack.window <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置 delta的深度</span>
</span></span><span style=display:flex><span>git config repack.depth <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置自动打包</span>
</span></span><span style=display:flex><span>git config gc.autoPackLimit <span style=color:#ae81ff>50</span>
</span></span></code></pre></div><h4 id=注意事项-5>注意事项</h4><ol><li>大型仓库可能耗时：深度优化可能需要较长时间</li><li>网络仓库慎用：可能导致后续推送需要重新上传对象</li><li>内存使用：大窗口/深度设置会增加内存消耗</li><li>通常不需要手动执行：<code>git gc</code>会自动处理</li></ol><h2 id=git-fsck><code>git fsck</code></h2><p><code>git fsck</code>（File System ChecK）是Git提供的仓库完整性检查工具，用于验证Git对象数据库的连通性和有效性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git fsck <span style=color:#f92672>[</span>选项<span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=核心功能-4>核心功能</h3><ol><li>验证对象完整性：检查所有Git对象（blob、tree、commit、tag）是否有效</li><li>检测损坏对象：找出存储损坏或内容不完整的对象</li><li>发现孤立对象：识别没有被任何引用指向的对象</li><li>检查仓库健康状态：确保仓库数据结构一致</li></ol><h3 id=常用选项-4>常用选项</h3><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>--full</code></td><td>执行完整检查（默认行为）</td></tr><tr><td><code>--unreachable</code></td><td>只显示不可达对象</td></tr><tr><td><code>dangling</code></td><td>显示悬空对象（无引用但未损坏）</td></tr><tr><td><code>--no-reflogs</code></td><td>忽略refolg引用进行检查</td></tr><tr><td><code>--strict</code></td><td>执行更严格的检查</td></tr><tr><td><code>--verbose</code></td><td>显示详细输出</td></tr><tr><td><code>--lost-found</code></td><td>将悬空对象写入<code>.git/lost-found</code></td></tr></tbody></table><h3 id=输出分析>输出分析</h3><ol><li>悬空对象</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>dangling blob &lt;sha1&gt;
</span></span><span style=display:flex><span>dangling commit &lt;sha1&gt;
</span></span></code></pre></div><p>这些是未被引用但内容完整的对象，通常安全</p><ol start=2><li>损坏对象</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>corrut blob &lt;sha1&gt;
</span></span><span style=display:flex><span>missing blob &lt;sha1&gt;
</span></span></code></pre></div><p>表示对象已损坏或丢失，需要修复</p><ol start=3><li>不可达对象</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>unreachable commit &lt;sha1&gt;
</span></span></code></pre></div><p>这些提交无法从任何引用达到</p><h2 id=git-reflog><code>git reflog</code></h2><p><code>git reflog</code>是Git的安全网，它记录了本地仓库中所有的引用变更历史，可以帮助恢复意外丢失的提交或分支</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog <span style=color:#f92672>[</span>show<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>&lt;引用&gt;<span style=color:#f92672>]</span> <span style=color:#75715e># 显示引用日志</span>
</span></span><span style=display:flex><span>git reflog expire <span style=color:#75715e># 删除过期的reflog条目</span>
</span></span><span style=display:flex><span>git reflog delete <span style=color:#75715e># 删除特定reflog条目</span>
</span></span></code></pre></div><h3 id=核心概念>核心概念</h3><ol><li>引用日志：记录HEAD和分支引用的所有变更</li><li>时间限制：默认保留90天（可通过<code>gc.reflogExpire</code>配置）</li><li>本地特有：reflog不会推送到远程仓库</li></ol><h3 id=使用>使用</h3><ol><li>查看HEAD的变更历史</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog
</span></span></code></pre></div><ol start=2><li>查看特定分支的历史</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog show feature-branch
</span></span></code></pre></div><p><strong>关键组成部分</strong></p><ol><li>提交哈希：每次操作对应的提交ID（可能缩写）</li><li>引用位置：如<code>HEAD@{n}</code>表示HEAD的第n次前位置</li><li>操作类型：commit、reset、checkout、merge等</li><li>操作描述：简要说明发生了什么</li></ol><h3 id=实用场景>实用场景</h3><ol><li>恢复误删的提交</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog
</span></span><span style=display:flex><span><span style=color:#75715e># 找到删除前的提交哈希</span>
</span></span><span style=display:flex><span>git checkout &lt;提交哈希&gt;
</span></span><span style=display:flex><span>git checkout -b  recovered-branch
</span></span></code></pre></div><ol start=2><li>撤销错误的reset</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog
</span></span><span style=display:flex><span>git reset --hard HEAD@<span style=color:#f92672>{</span>1<span style=color:#f92672>}</span> <span style=color:#75715e># 恢复到上一步状态</span>
</span></span></code></pre></div><ol start=3><li>找回误删的分支</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog | grep <span style=color:#e6db74>&#34;deleted branch&#34;</span>
</span></span><span style=display:flex><span>git branch &lt;分支名&gt; &lt;提交哈希&gt;
</span></span></code></pre></div><ol start=4><li>查看分支创建时间</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog show --date<span style=color:#f92672>=</span>iso &lt;分支名&gt;
</span></span></code></pre></div><ol start=5><li>显示详细时间信息</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog --date<span style=color:#f92672>=</span>iso
</span></span></code></pre></div><ol start=6><li>搜索特定操作</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog | grep <span style=color:#e6db74>&#34;merge&#34;</span>
</span></span></code></pre></div><ol start=7><li>清理旧纪录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git reflog expire --expire<span style=color:#f92672>=</span>now --all
</span></span><span style=display:flex><span>git gc
</span></span></code></pre></div><h3 id=注意事项-6>注意事项</h3><ol><li>reflog是本地独有的，不会推送到远程</li><li>默认保留90天（可通过<code>git config gc.reflogExpire</code>修改）</li><li>执行<code>git gc --prune=now</code>会清理reflog</li><li>重要变更建议立即创建分支或标签，而非依赖reflog</li></ol><h2 id=git-filter-branch><code>git filter-branch</code></h2><p><code>git filter-branch</code>是Git中一个强大的历史重写工具，它可以批量修改提交历史。由于它的破坏性和复杂性，Git官方现在推荐使用<code>git filter-repo</code>作为替代</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git filter-branch <span style=color:#f92672>[</span>选项<span style=color:#f92672>]</span> &lt;过滤器&gt; <span style=color:#f92672>[</span>修订范围<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>主要用途为</p><ul><li>从历史中彻底删除文件（包括所有提交记录）</li><li>修改提交元数据（作者/提交者信息）</li><li>提取子目录作为新仓库</li><li>全局替换文件内容</li></ul><p>常用过滤器类型</p><table><thead><tr><th>过滤器选项</th><th>作用</th></tr></thead><tbody><tr><td><code>--tree-filter</code></td><td>对每个提交的工作树执行命令（慢但彻底）</td></tr><tr><td><code>--index-filter</code></td><td>只修改暂存区（快，适用于文件删除）</td></tr><tr><td><code>--parent-fileter</code></td><td>修改提交的父引用</td></tr><tr><td><code>--msg-filter</code></td><td>修改提交信息</td></tr><tr><td><code>--env-filter</code></td><td>修改作者/提交者环境变量</td></tr><tr><td><code>--subdirectory-filter</code></td><td>提取子目录作为新根目录</td></tr></tbody></table><h3 id=使用场景>使用场景</h3><ol><li>从历史中删除大文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git filter-branch --force --index-filter <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;git rm --cached --inigore-unmatch 文件名&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --prune-empty --tag-name-filter cat -- --call
</span></span></code></pre></div><ol start=2><li>批量修改作者名字</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git filter-branch --env-filter <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  if [ &#34;$GIT_AUTHOR_NAME&#34; = &#34;旧名字&#34; ];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    GIT_AUTHOR_NAME=&#34;新名字&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    GIT_AUTHOR_EMAIL=&#34;新邮箱&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> -- --all
</span></span></code></pre></div><ol start=3><li>提取子目录为新仓库</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git filter-branch --sundirectory-filter 子目录名 -- --all
</span></span></code></pre></div><ol start=4><li>全局替换文件内容</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git filter-branch --tree-filter <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;sed -i &#34;s/旧文件/新文本/g&#34; 文件名&#39;</span> -- --all
</span></span></code></pre></div><h3 id=注意事项-7>注意事项</h3><ol><li>破坏性操作：会重写整个历史，必须提前备份</li><li>协作影响：重写后所有协作者需要重新克隆</li><li>性能问题：大型仓库可能耗时极长</li><li>替代方案：考虑使用<code>git filter-repo</code>（更现代的工具）</li></ol><h2 id=git-archive><code>git archive</code></h2><p><code>git archive</code>是Git提供的归档命令，用于将仓库内容打包成非Git格式的压缩文件，非常适合代码发布、备份或与不需要Git历史的用户共享项目</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive <span style=color:#f92672>[</span>选项<span style=color:#f92672>]</span> &lt;tree-ish&gt; <span style=color:#f92672>[</span>&lt;路径&gt;...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>核心功能</p><ol><li>将代码快照打包：不包含<code>.git</code>目录和版本控制信息</li><li>支持多种格式：zip, tar, tar.gz, tar.xz等</li><li>精确控制内容：可指定特定提交/分支/标签和子目录</li><li>保留文件权限：保持原始执行权限和属性</li></ol><p>常用选项</p><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>--format=&lt;fmt></code></td><td>指定格式（zip, tar, tar.gz）</td></tr><tr><td><code>--output=&lt;file></code></td><td>指定输出文件名</td></tr><tr><td><code>--prefix=&lt;prefix>/</code></td><td>为文件添加路径前缀</td></tr><tr><td><code>-v</code>/<code>--verbose</code></td><td>显示详细处理信息</td></tr><tr><td><code>-l</code>/<code>--list</code></td><td>列出支持的格式</td></tr></tbody></table><h3 id=用法>用法</h3><ol><li>打包当前分支最新代码</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive --format<span style=color:#f92672>=</span>zip --output<span style=color:#f92672>=</span>release-v1.0.zip HEAD
</span></span></code></pre></div><ol start=2><li>打包特定标签版本</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive --format<span style=color:#f92672>=</span>tar.gz v2.1.0 | gzip &gt; project-v2.1.0.tar.gz
</span></span></code></pre></div><ol start=3><li>只打包指定子目录</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive --format<span style=color:#f92672>=</span>zip HEAD:src/ &gt; src-only.zip
</span></span></code></pre></div><ol start=4><li>添加前缀路径</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive --format<span style=color:#f92672>=</span>tar --prefix<span style=color:#f92672>=</span>project-1.0/ v1.0 | gzip &gt; project-1,0.tar.gz
</span></span></code></pre></div><ol start=5><li>基于工作树创建归档（包含未提交修改）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive -o pathc.zip HEAD <span style=color:#66d9ef>$(</span>git diff --name-only HEAD<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=6><li>导出特定日期版本的代码</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive -o snapshot.zip <span style=color:#66d9ef>$(</span>git rev-list -n <span style=color:#ae81ff>1</span> --before<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2023-01-01&#34;</span> main<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=7><li>创建分卷压缩包</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive --format<span style=color:#f92672>=</span>tar HEAD | split -b 50m - project.tar.part
</span></span></code></pre></div><ol start=8><li>排除某些文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git archive HEAD --format<span style=color:#f92672>=</span>tar --output<span style=color:#f92672>=</span>project.tar <span style=color:#66d9ef>$(</span>git ls-files | grep -v <span style=color:#e6db74>&#39;test/&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h3 id=与普通压缩的区别>与普通压缩的区别</h3><table><thead><tr><th>特性</th><th>git archive</th><th>普通压缩</th></tr></thead><tbody><tr><td>内容来源</td><td>版本库快照</td><td>工作目录文件系统</td></tr><tr><td>包含.git</td><td>从不包含</td><td>可能包含</td></tr><tr><td>文件权限</td><td>精确保留</td><td>可能丢失</td></tr><tr><td>元数据</td><td>不含.git信息</td><td>保留所有文件属性</td></tr><tr><td>构建方式</td><td>基于提交对象</td><td>基于文件系统</td></tr></tbody></table><h3 id=注意事项-8>注意事项</h3><ol><li>归档不包含Git历史记录，仅包含文件快照</li><li>默认基于提交对象，如需包含工作目录修改需特殊处理</li><li>大仓库归档可能需要较长时间</li><li>建议在归当前执行<code>git gc</code>优化仓库</li></ol><h2 id=git-replace><code>git replace</code></h2><p><strong>基本作用</strong></p><ol><li>替换任意Git对象：commit、tree、blob、tag都可以</li><li>Git读取对象时，如果存在替换关系，会自动用替换对象替换原对象</li><li>原对象文件不变，提花内心戏记录在<code>.git/refs/replace/</code>下</li></ol><p><strong>语法</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 创建替换</span>
</span></span><span style=display:flex><span>git replace &lt;old&gt; &lt;new&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 列出替换记录</span>
</span></span><span style=display:flex><span>git replace -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除替换</span>
</span></span><span style=display:flex><span>git replace -d &lt;old&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清空所有替换</span>
</span></span><span style=display:flex><span>git replace --delete &lt;old&gt; <span style=color:#75715e># 单个</span>
</span></span><span style=display:flex><span>git replace --delete <span style=color:#66d9ef>$(</span>git replace -l<span style=color:#66d9ef>)</span> <span style=color:#75715e># 全部</span>
</span></span></code></pre></div><h3 id=应用场景>应用场景</h3><ol><li>修复历史提交信息</li></ol><ul><li>如果发现某个commit的作者写错了，但又不想用<code>git rebase</code>重写整个历史，可以</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git cat-file commit &lt;commit_sha&gt; tmp.txt
</span></span><span style=display:flex><span><span style=color:#75715e># 编辑tmp.txt修改作者信息</span>
</span></span><span style=display:flex><span>git hash-object -t commit -w tmp.txt
</span></span><span style=display:flex><span>git replace &lt;old_commit_sha&gt; &lt;new_commit_sha&gt;
</span></span></code></pre></div><p>这样Git会认为旧commit已经被替换了</p><ol start=2><li>测试新的父提交</li></ol><ul><li>临时更改某个commit的父指针，测试不同分支合并的结果</li></ul><ol start=3><li>调试或数据恢复</li></ol><ul><li>如果仓库损坏，可以用<code>git replace</code>指向修复后的对象，让仓库可用</li></ul><ol start=4><li>部分历史替换</li></ol><ul><li>如果fork了一个大仓库，只想替换某部分的历史文件，而不动其他commit</li></ul><h3 id=底层实现>底层实现</h3><p>当执行<code>git replace A B</code>时，Git会创建<code>.git/refs/replace/A</code>，里面的内容是<code>B</code>；当Git读取A时，会先看<code>.git/refs/replace/A</code>是否存在，如果有，就用B代替</p><h3 id=注意事项-9>注意事项</h3><ul><li>替换只是本地生效，不会推送到远程，除非显式推送<code>.git/refs/replace</code></li><li>适合临时修改、调试，不适合长期依赖</li><li>如果想永久修改历史，还是应该用<code>git filter-branch</code>或<code>git filter-repo</code></li></ul></div><nav class=post-nav><a href=/unixlike/log/tag/ class=hover:underline>pre: Tag</a>
<a href=/unixlike/log/tmux/ class=hover:underline>next: Tmux</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><a href=#工作区>工作区</a><ul><li><a href=#作用>作用</a></li><li><a href=#常用命令>常用命令</a></li><li><a href=#git-add><code>git add</code></a><ul><li><a href=#基本语法>基本语法</a></li><li><a href=#常用参数>常用参数</a></li><li><a href=#注意事项>注意事项</a></li></ul></li><li><a href=#git-restore><code>git restore</code></a><ul><li><a href=#核心功能>核心功能</a></li><li><a href=#基础用法>基础用法</a></li><li><a href=#注意事项-1>注意事项</a></li></ul></li></ul></li><li><a href=#暂存区>暂存区</a><ul><li><a href=#作用-1>作用</a></li><li><a href=#特点>特点</a></li><li><a href=#常用命令-1>常用命令</a></li><li><a href=#原理>原理</a></li></ul></li><li><a href=#git仓库>Git仓库</a><ul><li><a href=#特点-1>特点</a></li><li><a href=#仓库结构>仓库结构</a><ul><li><a href=#objects-in-git>objects in .git</a><ul><li><a href=#四种对象类型>四种对象类型</a></li><li><a href=#总结>总结</a></li></ul></li></ul></li><li><a href=#常用命令-2>常用命令</a></li><li><a href=#git-commit><code>git commit</code></a><ul><li><a href=#常用参数-1>常用参数</a></li><li><a href=#最佳实践>最佳实践</a></li></ul></li><li><a href=#git-show><code>git show</code></a><ul><li><a href=#基本用法>基本用法</a></li></ul></li><li><a href=#git-init><code>git init</code></a><ul><li><a href=#常用选项>常用选项</a></li><li><a href=#注意事项-2>注意事项</a></li></ul></li><li><a href=#git-clone><code>git clone</code></a><ul><li><a href=#核心功能-1>核心功能</a></li><li><a href=#常用用法>常用用法</a></li><li><a href=#支持的协议>支持的协议</a></li><li><a href=#注意事项-3>注意事项</a></li></ul></li><li><a href=#git-gc><code>git gc</code></a><ul><li><a href=#常用选项-1>常用选项</a></li><li><a href=#执行时机>执行时机</a></li><li><a href=#配置参数>配置参数</a></li><li><a href=#git-prune><code>git prune</code></a><ul><li><a href=#核心功能-2>核心功能</a></li><li><a href=#常用选项-2>常用选项</a></li><li><a href=#工作原理>工作原理</a></li><li><a href=#注意事项-4>注意事项</a></li></ul></li><li><a href=#git-repack><code>git repack</code></a><ul><li><a href=#核心功能-3>核心功能</a></li><li><a href=#常用选项-3>常用选项</a></li><li><a href=#配置参数-1>配置参数</a></li><li><a href=#注意事项-5>注意事项</a></li></ul></li></ul></li><li><a href=#git-fsck><code>git fsck</code></a><ul><li><a href=#核心功能-4>核心功能</a></li><li><a href=#常用选项-4>常用选项</a></li><li><a href=#输出分析>输出分析</a></li></ul></li><li><a href=#git-reflog><code>git reflog</code></a><ul><li><a href=#核心概念>核心概念</a></li><li><a href=#使用>使用</a></li><li><a href=#实用场景>实用场景</a></li><li><a href=#注意事项-6>注意事项</a></li></ul></li><li><a href=#git-filter-branch><code>git filter-branch</code></a><ul><li><a href=#使用场景>使用场景</a></li><li><a href=#注意事项-7>注意事项</a></li></ul></li><li><a href=#git-archive><code>git archive</code></a><ul><li><a href=#用法>用法</a></li><li><a href=#与普通压缩的区别>与普通压缩的区别</a></li><li><a href=#注意事项-8>注意事项</a></li></ul></li><li><a href=#git-replace><code>git replace</code></a><ul><li><a href=#应用场景>应用场景</a></li><li><a href=#底层实现>底层实现</a></li><li><a href=#注意事项-9>注意事项</a></li></ul></li></ul></li></ul></nav></aside><script src=/js/scrollspy.js defer></script><script type=module>
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ 
    startOnLoad: true, theme: "default" });
</script><footer><div class=container><p>© 2026 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSES.md>Full License</a></p></div></footer></body></html>