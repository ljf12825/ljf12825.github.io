<!doctype html><html lang=en><head><meta name=page-kind content="page"><meta charset=UTF-8><title>CMake</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-ini.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=stylesheet href=/css/blogsingle.css></head><body><header class=site-header><div class=container><div class=terminal-overlay aria-label=terminal-prompt><span id=typed-line></span><span class=cursor>█</span></div></div></header><nav class=topnav><div class=container><ul><li><a href=/unixlike/>★</a></li><li><a href=/unixlike/lab/>Lab</a></li><li><a href=/unixlike/lib/>Lib</a></li><li><a href=/unixlike/file/>File</a></li></ul></div></nav><nav id=star-nav><div id=star-header><span class="title open">>> >> >> Navigation &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Nav>>>>>></span></div><pre class=ascii>
+——————————————————————————————————————————————————————————————+
|                        <a class=nav-item data-path=/rightbrain/ href=/rightbrain/>RightBrain</a>                            |
|                             |                                |
|                             |     <a class=nav-item data-path=/dotnetandwindows/ href=/dotnetandwindows/>.NET-Windows</a>               |
|                             |    /                           |
|                             |   /             <a class=nav-item data-path=/engine/ href=/engine/>Engine</a>         |
|                             |  /                 |           |
|                             | /                  |           |
|                             |/                   |           |
|      <a class=nav-item data-path=/graphic/ href=/graphic/>Graphic</a> ———————————— <a class=nav-item data-path=/home/ href=/home/>Home</a> ————————————— <a class=nav-item data-path=/framework/ href=/framework/>Framework</a>       |
|                            /|                                |
|                           / |                                |
|                          /  |                                |
|                         /   |       <a class=nav-item data-path=/language/ href=/language/>Language</a>                 |
|                        /    |      /                         |
|                       /     |     /                          |
|              <a class=nav-item data-path=/unixlike/ href=/unixlike/>Unix-like</a>      |    /           <a class=nav-item data-path=/project/ href=/project/>Project</a>         |
|                             |   /            <a class=nav-item data-path=/miscellaneous/ href=/miscellaneous/>Miscellaneous</a>   |
|                          <a class=nav-item data-path=/csbasic/ href=/csbasic/>CSBasic</a>             <a class=nav-item data-path=/ai/ href=/ai/>AI</a>              |
+——————————————————————————————————————————————————————————————+
    </pre></nav><script defer src=/js/star-nav.js></script><script defer src=/js/site.js></script><script defer src=/js/star-active.js></script><div id=ref-window class="float-window open"><div class=float-header><span class="title open">>> >> >> Reference &lt;&lt; &lt;&lt; &lt;&lt;</span>
<span class="title closed">&lt;&lt;&lt;&lt;&lt;&lt;Ref>>>>>></span></div><div class=float-body><div class=ref-list><a href=https://www.mixamo.com/ target=_blank>Mixamo</a> |
<a href=https://opengameart.org/ target=_blank>OpenGameArt</a><p><a href=https://sharplab.io/ target=_blank>SharpLab</a> |
<a href=https://godbolt.org/ target=_blank>Compiler Explorer</a></p><p><a href="https://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type+Something+&x=none&v=4&h=4&w=80&we=false" target=_blank>ASCII Graph Generator</a></p><p><a href=https://mermaid.js.org/ target=_blank>Mermaid</a></p><a href=https://www.vim.org/ target=_blank>Vim</a> | <a href=https://vimdoc.sourceforge.net/ target=_blank>Vim Manual Source</a> |
<a href=https://vimcdoc.sourceforge.net/ target=_blank>Vimcdoc</a> | <a href=https://vimcdoc.sourceforge.net/doc/help.html target=_blank>Vimdoc read online</a><p><a href=https://shields.io/ target=_blank>Shields.io</a></p><p><a href=https://emojidb.org/ target=_blank>EmojiDB</a></p><p><a href=https://cppreference.com/ target=_blank>cppreference</a></p><p><a href=https://gcc.gnu.org/onlinedocs/ target=_blank>GCC Docs</a></p><p><a href=https://clang.llvm.org/docs/ target=_blank>Clang Docs</a></p><p><a href=https://www.boost.org/libraries/ target=_blank>Boost Library Docs</a></p><p><a href=https://learn.microsoft.com/en-us/dotnet/csharp/ target=_blank>Microsoft Learn</a><p><a href=https://www.lua.org/manual/5.4/ target=_blank>Lua 5.4 Reference Manual</a><p><a href=https://docs.unity3d.com/Manual/index.html target=_blank>Unity Manual</a> |
<a href=https://docs.unity3d.com/ScriptReference/index.html target=_blank>Unity API</a></p><p><a href=https://docs.unrealengine.com/ target=_blank>Unreal Engine Docs</a></p><p><a href=https://godotengine.org target=_blank>Godot</a> |
<a href=https://docs.godotengine.org/en/stable/ target=_blank>Godot Docs</a></p><p><a href=https://z-library.sk/ target=_blank>Z-Library</a> : eBook Library</p><p><a href=https://docs.kernel.org/ target=_blank>Linux Kernel Docs</a></p><p><a href=https://www.gnu.org/ target=_blank>GNU</a> : manuals, philosophy, FAQ</p><a href=https://archlinux.org/ target=_blank>ArchLinux</a><p><a href=https://help.ubuntu.com/ target=_blank>Ubuntu Doc</a> |
<a href=https://ubuntu.com/server/docs target=_blank>Ubuntu Server Guide</a></p><p><a href=https://www.vulkan.org/ target=_blank>Vulkan</a> |
<a href=https://docs.vulkan.org/ target=_blank>Vulkan Docs</a></p><p><a href=https://www.opengl.org/ target=_blank>OpenGL</a> |
<a href=https://registry.khronos.org/OpenGL target=_blank>OpenGL API</a> |
<a href=https://www.khronos.org/opengl/wiki/ target=_blank>OpenGL Wiki</a></p><p><a href=https://learn.microsoft.com/en-us/windows/win32/directx target=_blank>DirectX</a></p><p><a href=https://www.realtimerendering.com/ target=_blank>Real-Time Rendering</a></p><p><a href=https://www.pbr-book.org/ target=_blank>Physically Based Rendering</a></p><p><a href=https://www.scratchapixel.com/ target=_blank>Scratchapixel</a></p><p><a href=https://learnopengl.com/ target=_blank>LearnOpenGL</a></p><p><a href=https://raytracing.github.io/ target=_blank>Ray Tracing in One Weekend</a></p><p><a href=https://www.shadertoy.com/ target=_blank>Shadertoy</a></p><p><a href=https://arxiv.org/list/cs.GR/recent target=_blank>arXiv Graphics</a></p><p><a href=https://www.siggraph.org/ target=_blank>SIGGRAPH</a> |
<a href=https://dl.acm.org/conference/siggraph target=_blank>SIGGRAPH Digital Library</a></p><p><a href=https://git-scm.com/ target=_blank>Git</a> |
<a href=https://git-scm.com/doc target=_blank>Docs</a> |
<a href=https://git-scm.com/community target=_blank>Community</a></p></div></div></div><script src=/js/ref-window.js></script><article class=single_article><div class=title>CMake<div class=meta>Modified: 2025-12-31
| Author：ljf12825</div></div><div class=content><p>假设有一个C++项目，里面有几十个源文件，依赖好几个外部库。需要在不同的平台上编译它：</p><ul><li>Windows：用Visual Studio</li><li>Linux：用GCC</li><li>macOS：用Clang</li><li>直接使用编译器命令：<code>g++ main.cpp file1.cpp ... -o myapp</code>。对于小项目可以，大项目会变得极其繁琐且难以维护</li><li>直接写Makefile：在Linux上很常见，但语法晦涩，且不能跨平台。Windows上的Visual Studio不使用Makefile</li><li>使用IDE的项目文件：比如直接创建一个Visual Studio项目。但如果没有Windows机器，就无法为Linux构建</li></ul><p>CMake的解决方案是：
不需要直接写Makefile或<code>.vcxproj</code>文件，而是用一个独立于编译器和平台的、更高级的语言（CMake语言）编写一个配置文件，叫做<code>CMakeLists.txt</code></p><p>然后，CMake会根据你的平台和你选择的编译器，生成对应的原生构建文件</p><ul><li>在Linux上 -> 生成<code>Makefile</code></li><li>在Windows上 -> 生成 Visual Studio 解决方案（<code>.sln</code>和<code>.vcxproj</code>）</li><li>在macOS上 -> 生成<code>Xcode</code>工程</li><li>它还可以生成<code>Ninja</code>等</li></ul><p>CMake是现代C++/C项目中最常见的构建系统生成工具，可以把它理解为<strong>跨平台的项目构建脚本语言</strong> + <strong>构建系统生成器</strong></p><p>所以CMake的好处是：写一份<code>CMakeLists.txt</code>，到处都能用</p><p>CMake在开发流程中的位置</p><p><img src=/images/Blog/CMake_1.png alt=流程图></p><p>CMake在工具链中的位置</p><p><img src=/images/Blog/CMake_2.png alt=工具链中的位置></p><p>跨平台和交叉编译</p><p><img src=/images/Blog/CMake_3.png alt=跨平台中的位置></p><h2 id=cmake基本工作流程>CMake基本工作流程</h2><ol><li>配置（Configure）</li></ol><ul><li>执行<code>cmake /path/to/source</code></li><li>CMake读取源代码目录中的<code>CMakeLists.txt</code>文件</li><li>它检查系统环境：编译器是否存在？依赖库在哪里？等等</li><li>它在构建目录（通常是单独的<code>build</code>目录，这与“源代码分离构建”的最佳实践有关）中生成一个缓存文件<code>CMakeCache.txt</code>，保存了这些配置信息</li></ul><ol start=2><li>生成（Generate）</li></ol><ul><li>根据上一步的配置，CMake在构建目录中生成所需要的原生构建文件（如<code>Makefile</code>）<ul><li>例如在Linux：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir build
</span></span><span style=display:flex><span>cd build
</span></span><span style=display:flex><span>cmake ..
</span></span></code></pre></div>它会在<code>build</code>目录下生成<code>Makefile</code></li></ul><ol start=3><li>构建（Build）</li></ol><ul><li>Linux上就是<code>make</code></li><li>Windows上就是打开生成的<code>.sln</code>或者用<code>msbuild</code></li></ul><h2 id=cmake语法>CMake语法</h2><p>CMake虽不像C++那样复杂，但它其实是一个<strong>声明式</strong> + <strong>脚本式DSL</strong>，有自己的一套规则和陷阱</p><h3 id=基本特点>基本特点</h3><ol><li>大小写不敏感，推荐小写</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>PROJECT(<span style=color:#e6db74>MyProj</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>project(<span style=color:#e6db74>MyProj</span>) <span style=color:#75715e># 等价
</span></span></span></code></pre></div><ol start=2><li>逐行解释，顺序敏感</li><li>注释：<code>#</code>后面的内容是注释</li><li>变量引用：用<code>${var}</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>set</span>(MYVAR Hello)
</span></span><span style=display:flex><span><span style=color:#a6e22e>message</span>(<span style=color:#960050;background-color:#1e0010>$</span>{MYVAR}) <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#960050;background-color:#1e0010>输出</span> Hello
</span></span></code></pre></div><h3 id=变量>变量</h3><ul><li>定义变量</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>NAME</span> <span style=color:#e6db74>value</span>) <span style=color:#75715e># 普通变量
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>NAME</span> <span style=color:#e6db74>&#34;a;b;c&#34;</span>) <span style=color:#75715e># 列表（用；分隔）
</span></span></span></code></pre></div><ul><li>环境变量</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>ENV{PATH}</span> <span style=color:#e6db74>/usr/local/bin</span>) <span style=color:#75715e># 设置环境变量
</span></span></span><span style=display:flex><span>message(<span style=color:#f92672>$ENV{</span>PATH<span style=color:#f92672>}</span>) <span style=color:#75715e># 读取环境变量
</span></span></span></code></pre></div><h3 id=控制语句>控制语句</h3><ol><li>if</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>if (<span style=color:#e6db74>VAR</span> <span style=color:#e6db74>STREQUAL</span> <span style=color:#e6db74>&#34;Hello&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Matched&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>elseif(<span style=color:#e6db74>VAR</span> <span style=color:#e6db74>MATCHES</span> <span style=color:#e6db74>&#34;He.*&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Regex matched&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>else()<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;No match&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endif()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>常见比较操作：<ul><li><code>STREQUAL</code>：字符串相等</li><li><code>EQUAL</code>：数字相等</li><li><code>MATCHES</code>：正则匹配</li><li><code>LESS</code>, <code>GREATER</code>：数值比较</li><li><code>EXISTS path</code>：文件或目录存在</li></ul></li></ul><ol start=2><li>foreach</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>NAMES</span> <span style=color:#e6db74>Alice</span> <span style=color:#e6db74>Bob</span> <span style=color:#e6db74>Charlie</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>foreach(<span style=color:#e6db74>name</span> <span style=color:#f92672>${</span>NAMES<span style=color:#f92672>}</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Name: ${name}&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endforeach()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>也支持范围</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>foreach(<span style=color:#e6db74>i</span> <span style=color:#e6db74>RANGE</span> <span style=color:#e6db74>3</span>) <span style=color:#75715e># 0 1 2 3
</span></span></span><span style=display:flex><span>foreach(<span style=color:#e6db74>i</span> <span style=color:#e6db74>RANGE</span> <span style=color:#e6db74>1</span> <span style=color:#e6db74>5</span> <span style=color:#e6db74>2</span>) <span style=color:#75715e># 1 3 5 [1, 5]间隔为2
</span></span></span><span style=display:flex><span>endforeach()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=3><li>while</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>i</span> <span style=color:#e6db74>0</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>while(<span style=color:#e6db74>i</span> <span style=color:#e6db74>LESS</span> <span style=color:#e6db74>3</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#f92672>${</span>i<span style=color:#f92672>}</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    math(<span style=color:#e6db74>EXPR</span> <span style=color:#e6db74>i</span> <span style=color:#e6db74>&#34;${i}+1&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endwhile()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=函数与宏>函数与宏</h3><p>函数（作用域内变量）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>funciton(<span style=color:#e6db74>print_message</span> <span style=color:#e6db74>arg1</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Function: ${arg1}&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endfunction()<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>print_message(<span style=color:#e6db74>&#34;Hello&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>宏(全局变量修改)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>macro(<span style=color:#e6db74>print_message</span> <span style=color:#e6db74>arg1</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Macro: ${arg1}&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endmacro()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>区别：<code>function</code>内的<code>set()</code>默认是局部的，而<code>macro</code>会直接修改外部变量</p><h3 id=列表操作>列表操作</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>LST</span> <span style=color:#e6db74>a</span> <span style=color:#e6db74>b</span> <span style=color:#e6db74>c</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>list(<span style=color:#e6db74>APPEND</span> <span style=color:#e6db74>LST</span> <span style=color:#e6db74>d</span>) <span style=color:#75715e># a;b;c;d
</span></span></span><span style=display:flex><span>list(<span style=color:#e6db74>LENGTH</span> <span style=color:#e6db74>LST</span> <span style=color:#e6db74>len</span>) <span style=color:#75715e># len=4
</span></span></span><span style=display:flex><span>list(<span style=color:#e6db74>GET</span> <span style=color:#e6db74>LST</span> <span style=color:#e6db74>1</span> <span style=color:#e6db74>second</span>) <span style=color:#75715e># second=b
</span></span></span><span style=display:flex><span>list(<span style=color:#e6db74>REMOVE_ITEM</span> <span style=color:#e6db74>LST</span> <span style=color:#e6db74>b</span>) <span style=color:#75715e># LST=a;b;c
</span></span></span></code></pre></div><h3 id=字符串操作>字符串操作</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>string(<span style=color:#e6db74>TOUPPER</span> <span style=color:#e6db74>&#34;abc&#34;</span> <span style=color:#e6db74>OUT</span>) <span style=color:#75715e># OUT=ABC
</span></span></span><span style=display:flex><span>string(<span style=color:#e6db74>REPLACE</span> <span style=color:#e6db74>&#34;a&#34;</span> <span style=color:#e6db74>&#34;X&#34;</span> <span style=color:#e6db74>OUT</span> <span style=color:#e6db74>&#34;abc&#34;</span>) <span style=color:#75715e># OUT=Xbc
</span></span></span><span style=display:flex><span>string(<span style=color:#e6db74>REGEX</span> <span style=color:#e6db74>MATCH</span> <span style=color:#e6db74>&#34;[0-9]+&#34;</span> <span style=color:#e6db74>NUM</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#e6db74>abc123def</span>) <span style=color:#75715e># NUM=123
</span></span></span></code></pre></div><h3 id=文件与路径>文件与路径</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>file(<span style=color:#e6db74>READ</span> <span style=color:#e6db74>my.txt</span> <span style=color:#e6db74>CONTENTS</span>) <span style=color:#75715e># 读文件
</span></span></span><span style=display:flex><span>file(<span style=color:#e6db74>WRITE</span> <span style=color:#e6db74>out.txt</span> <span style=color:#e6db74>&#34;Hello&#34;</span>) <span style=color:#75715e># 写文件
</span></span></span><span style=display:flex><span>file(<span style=color:#e6db74>MAKE_DIRECTORY</span> <span style=color:#e6db74>build/include</span>) <span style=color:#75715e># 创建目录
</span></span></span><span style=display:flex><span>file(<span style=color:#e6db74>GLOB</span> <span style=color:#e6db74>SOURCES</span> <span style=color:#e6db74>&#34;*.cpp&#34;</span>) <span style=color:#75715e># 通配符获取文件
</span></span></span></code></pre></div><h3 id=数学与逻辑>数学与逻辑</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>math(<span style=color:#e6db74>EXPR</span> <span style=color:#e6db74>result</span> <span style=color:#e6db74>&#34;3 + 7&#34;</span>) <span style=color:#75715e># result=10
</span></span></span></code></pre></div><p>逻辑运算在<code>if</code>中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>if(<span style=color:#e6db74>A</span> <span style=color:#e6db74>AND</span> <span style=color:#e6db74>B</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>if(<span style=color:#e6db74>NOT</span> <span style=color:#e6db74>C</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=构建命令>构建命令</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_executable(<span style=color:#e6db74>app</span> <span style=color:#e6db74>main.cpp</span>) <span style=color:#75715e># 可执行文件
</span></span></span><span style=display:flex><span>add_library(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>STATIC</span> <span style=color:#e6db74>a.cpp</span> <span style=color:#e6db74>b.cpp</span>) <span style=color:#75715e># 静态库
</span></span></span><span style=display:flex><span>add_library(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>SHARED</span> <span style=color:#e6db74>a.cpp</span> <span style=color:#e6db74>b.cpp</span>) <span style=color:#75715e># 动态库
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>mylib</span>) <span style=color:#75715e># 链接库
</span></span></span><span style=display:flex><span>target_include_directories(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>inc/</span>) <span style=color:#75715e># 添加头文件路径
</span></span></span></code></pre></div><h3 id=target属性现代cmake推荐>target属性（现代CMake推荐）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#75715e># 作用范围
</span></span></span><span style=display:flex><span><span style=color:#75715e># PRIVATE 仅自己使用
</span></span></span><span style=display:flex><span><span style=color:#75715e># PUBLIC 自己和依赖者都用
</span></span></span><span style=display:flex><span><span style=color:#75715e># INTERFACE 仅依赖者使用
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_compile_definitions(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>DEBUG_MODE</span>) <span style=color:#75715e># 宏定义
</span></span></span><span style=display:flex><span>target_compile_options(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>-Wall</span> <span style=color:#e6db74>-Wextra</span>) <span style=color:#75715e># 编译选项
</span></span></span></code></pre></div><h3 id=模块与包>模块与包</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>find_package(<span style=color:#e6db74>OpenGL</span> <span style=color:#e6db74>REQUIRED</span>) <span style=color:#75715e># 查找外部库
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>OpenGL::GL</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=子目录与安装>子目录与安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_subdirectory(<span style=color:#e6db74>src</span>) <span style=color:#75715e># 引入子目录
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>TARGETS</span> <span style=color:#e6db74>app</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>bin</span>) <span style=color:#75715e># 安装可执行文件
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>FILES</span> <span style=color:#e6db74>config.h</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>include</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=工具>工具</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake .. <span style=color:#75715e># 生成构建文件</span>
</span></span><span style=display:flex><span>cmake --build . <span style=color:#75715e># 构建（跨平台）</span>
</span></span><span style=display:flex><span>cmake --install . --prefix /usr <span style=color:#75715e># 安装</span>
</span></span></code></pre></div><h3 id=cmake特有命令>CMake特有命令</h3><ul><li>project(name)：定义项目名</li><li>set()：设置变量</li><li>add_executable(target srcs&mldr;)：生成可执行文件</li><li>add_library(target srcs&mldr;)：生成静态库或动态库</li><li>target_link_libraries(target lib&mldr;)：链接库</li><li>include_directories(path)：添加头文件目录</li><li>find_package(pkg REQUIRED)：查找并使用外部库</li></ul><h2 id=cmake功能>CMake功能</h2><h3 id=debugrelease>Debug/Release</h3><p>CMake的Debug和Release模式是构建系统的核心概念，几乎每个实际项目都会用到。它们本质上是构建配置（Build Configuration），控制编译器优化级别、调试符号、宏定义等</p><p>CMake通过一个变量<code>CMAKE_BUILD_TYPE</code>来控制构建类型（单配置生成器），或者通过生成器本身来切换（多配置生成器）<br>常见的配置有：</p><ul><li><p>Dubug</p><ul><li>编译时不优化（或少优化）</li><li>保留完整调试信息（符号表）</li><li>通常会定义<code>DEBUG</code>宏</li></ul></li><li><p>Release</p><ul><li>编译时进行优化（如<code>-03</code>）</li><li>去掉调试信息或只保留少量</li><li>通常会定义<code>NDEBUG</code>宏（禁用断言）</li></ul></li><li><p>RelWithDebInfo</p><ul><li>Release优化 + 调试信息</li></ul></li><li><p>MinSizeRel</p><ul><li>Release优化，目标时最小二进制体积</li></ul></li></ul><h4 id=设置方式>设置方式</h4><ol><li>单配置生成器（Makefile、Ninja）
需要手动指定：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_BUILD_TYPE<span style=color:#f92672>=</span>Debug ..
</span></span><span style=display:flex><span>cmake -DCMAKE_BUILD_TYPE<span style=color:#f92672>=</span>Release ..
</span></span><span style=display:flex><span>make
</span></span></code></pre></div><ol start=2><li>多配置生成器（Visual Studio、XCode）
它们支持多配置，不用再CMake阶段指定，而是在IDE里切换：</li></ol><ul><li>Visual Studio -> 工具栏有Debug/Release下拉框</li><li>Xcode -> scheme里切换</li></ul><p>命令行构建方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake --build . --config Debug
</span></span><span style=display:flex><span>cmake --build . --config Release
</span></span></code></pre></div><h4 id=cmake内部变量>CMake内部变量</h4><p>当选择不同配置时，CMake会自动设置一些编译器/链接器参数
例如（GCC/Clang下）：</p><ul><li><code>CMAKE_CXX_FLAGS_DEBUG</code> -> <code>-g -O0</code></li><li><code>CMAKE_CXX_FLAGS_RELEASE</code> -> <code>-03 -DNDEBUG</code></li><li><code>CMAKE_CXX_FLAGS_RELWITHDEBINFO</code> -> <code>-02 -g</code></li><li><code>CMAKE_CXX_FLAGS_MINSIZEREL</code> -> <code>-0s -DNDEBUG</code></li></ul><p>可以覆盖或追加</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_CXX_FLAGS_DEBUG</span> <span style=color:#e6db74>&#34;${CMAKE_CXX_FLAGS_DEBUG} -Wall&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h4 id=在cmakeliststxt中使用>在CMakeLists.txt中使用</h4><p>可以根据构建类型做条件控制</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>if(<span style=color:#e6db74>CMAKE_BUILD_TYPE</span> <span style=color:#e6db74>STREQUAL</span> <span style=color:#e6db74>&#34;Debug&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Building Debug version&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    add_definitions(<span style=color:#e6db74>-DDEBUG_MODE</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>elseif(<span style=color:#e6db74>CMAKE_BUILD_TYPE</span> <span style=color:#e6db74>STREQUAL</span> <span style=color:#e6db74>&#34;Release&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>    message(<span style=color:#e6db74>&#34;Building Release version&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>endif()<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>更推荐现代写法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_compline_definitions(<span style=color:#e6db74>myapp</span> <span style=color:#e6db74>PRIVATE</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>$&lt;</span>$&lt;CONFIG:Debug<span style=color:#f92672>&gt;</span><span style=color:#e6db74>:DEBUG_MODE&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>$&lt;</span>$&lt;CONFIG:Release<span style=color:#f92672>&gt;</span><span style=color:#e6db74>:NDEBUG_MODE&gt;</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这里用了生成表达式<code>$&lt;CONFIG:...></code>，自动根据配置切换</p><p><strong>实际开发中的使用场景</strong></p><ol><li>调试时 -> 用<code>Debug</code>，有完整符号，方便调试器定位问题</li><li>发布给用户时 -> 用<code>Release</code>，优化过的二进制，运行更快更小</li><li>线上诊断 -> 有时会用<code>RelWithDebInfo</code>，既有优化，又保留符号文件，便于分析crash</li><li>嵌入式/移动平台 -> 有时用<code>MinSizeRel</code>，为了减小体积</li></ol><h3 id=跨平台工具链>跨平台工具链</h3><p>CMake默认使用本机编译器（Linux上用GCC/Clang，Windows上用MSVC，macOS上用AppleClang）
但如果要：</p><ul><li>在 x86 PC上编译ARM代码（交叉编译，给Android、树莓派、嵌入式设备用）</li><li>在Windows上用MinGW编译Windows程序（而不是MSVC）</li><li>在Linux上生成Windows可执行文件（跨平台构建）</li></ul><p>这时就需要工具链文件（Toolchain File）告诉CMake：要用什么编译器、链接器、sysroot、库路径、平台信息</p><h4 id=指定工具链文件>指定工具链文件</h4><p>运行cmake时指定</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_TOOLCHAIN_FILE<span style=color:#f92672>=</span>path/to/toolchain.cmake ..
</span></span></code></pre></div><p>例如给Android构建：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_TOOLCHAIN_FILE<span style=color:#f92672>=</span>$ANDROID_NDK/build/cmake/android.toolchain.cmake ..
</span></span></code></pre></div><h4 id=工具链文件的内容>工具链文件的内容</h4><p>一个toolchain.cmake文件本质上就是一份<code>CMakeLists.txt</code>片段，里面写编译器和平台信息</p><p>示例：交叉编译到ARM Linux</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#75715e># toolchain-arm.cmake
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_SYSTEM_NAME</span> <span style=color:#e6db74>Linux</span>) <span style=color:#75715e># 目标平台系统
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_SYSTEM_PROCESSOR</span> <span style=color:#e6db74>arm</span>) <span style=color:#75715e># 目标架构
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 指定交叉编译工具链
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_C_COMPILER</span> <span style=color:#e6db74>arm-linux-gnueabihf-gcc</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_CXX_COMPILER</span> <span style=color:#e6db74>arm-linux-gnueabihf-g++</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH</span> <span style=color:#e6db74>/usr/arm-linux-gnueabihf</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 搜索规则
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_PROGRAM</span> <span style=color:#e6db74>NEVER</span>) <span style=color:#75715e># 不在目标环境找可执行程序
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span> <span style=color:#e6db74>ONLY</span>) <span style=color:#75715e># 只在目标环境找库
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</span> <span style=color:#e6db74>ONLY</span>) <span style=color:#75715e># 只在目标环境找头文件
</span></span></span></code></pre></div><p>构建：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_TOOLCHAIN_FILE<span style=color:#f92672>=</span>toolchain-arm.cmake ..
</span></span><span style=display:flex><span>make
</span></span></code></pre></div><h4 id=现代cmake更推荐的做法>现代CMake更推荐的做法</h4><p>在CMakePresets.json里定义工具链，更方便管理<br>例如</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;cmakeMinimumRequired&#34;</span>: { <span style=color:#f92672>&#34;major&#34;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#f92672>&#34;minor&#34;</span>: <span style=color:#ae81ff>20</span>},
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;configurePresets&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;linux-arm&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;generator&#34;</span>: <span style=color:#e6db74>&#34;Ninja&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;toolchainFile&#34;</span>: <span style=color:#e6db74>&#34;cmake/toolchains/toolchain-arm.cmake&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;cacheVariables&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;CMAKE_BUILD_TYPE&#34;</span>: <span style=color:#e6db74>&#34;Release&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后就可以</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake --preset linux-arm
</span></span></code></pre></div><h3 id=安装与导出>安装与导出</h3><h4 id=安装install>安装（install）</h4><p>目的：把编译好的二进制文件、头文件、配置文件复制到一个标准位置，供其他项目使用<br>常见用法</p><ol><li>安装可执行文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>add_execetable</span>(myapp main.cpp)
</span></span><span style=display:flex><span><span style=color:#a6e22e>install</span>(TARGETS myapp DESTINATION bin)
</span></span></code></pre></div><p>安装后<code>myapp</code>会被放到<code>&lt;prefix>/bin</code></p><ol start=2><li>安装库</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_library(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>STATIC</span> <span style=color:#e6db74>foo.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>TARGETS</span> <span style=color:#e6db74>mylib</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>安装后<code>libmylib.a</code>在<code>&lt;prefix>/lib</code></p><ol start=3><li>安装头文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>install(<span style=color:#e6db74>FILES</span> <span style=color:#e6db74>foo.h</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>include</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>DIRECTORY</span> <span style=color:#e6db74>include/</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>include</span>) <span style=color:#75715e># 整个目录
</span></span></span></code></pre></div><ol start=4><li>安装配置文件、资源文件</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>install(<span style=color:#e6db74>FILES</span> <span style=color:#e6db74>config.json</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>share/myproj</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=5><li>设置安装前缀</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_INSTALL_PREFIX<span style=color:#f92672>=</span>/usr/local ..
</span></span><span style=display:flex><span>make install
</span></span></code></pre></div><p>最终文件会安装到<code>/usr/local/bin</code>,<code>/usr/local/lib</code>,<code>/usr/local/include</code></p><h4 id=导出export>导出（export）</h4><p>目的：让别人通过<code>find_package()</code>使用你的库</p><ol><li>导出目标</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>install(<span style=color:#e6db74>TATGETS</span> <span style=color:#e6db74>mylib</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>EXPOrT</span> <span style=color:#e6db74>mylibTargets</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>EXPORT</span> <span style=color:#e6db74>mylibTargets</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>NAMESPACE</span> <span style=color:#e6db74>MyLib::</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib/cmake/mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这样会生成一个<code>mylibTargets.cmake</code>，里面描述了目标 + 依赖
别人<code>find_package(mylib)</code>时就能拿到<code>MyLib::mylib</code>目标</p><ol start=2><li>包配置文件
需要写一个mylibConfig.cmake，让CMake知道如何找到<code>mylibTargets.cmake</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#75715e># mylibConfig.cmake
</span></span></span><span style=display:flex><span>include(<span style=color:#e6db74>&#34;${CMAKE_CURRENT_LIST_DIR}/mylibTargets.cmake&#34;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>然后安装它</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>install(<span style=color:#e6db74>FILES</span> <span style=color:#e6db74>mylibConfig.cmake</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib/cmake/mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h4 id=完整工作流>完整工作流</h4><p>假设写了一个库<code>mylib</code></p><ol><li>CMakeLists.txt</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minimu_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.15</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>project(<span style=color:#e6db74>MyLib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_library(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>foo.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_include_directories(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>include</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>TARGETS</span> <span style=color:#e6db74>mylib</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>EXPORT</span> <span style=color:#e6db74>mylibTargets</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>EXPORT</span> <span style=color:#e6db74>mylibTargets</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>NAMESPACE</span> <span style=color:#e6db74>MyLib::</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib/cmake/mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>DIRECTORY</span> <span style=color:#e6db74>include/</span> <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>include</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>include(<span style=color:#e6db74>CMakePackageConfigHelpers</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>write_basic_package_version_file(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;${CMAKE_CURRENT_BINARY_DIR}/mylibConfigVersion.cmake&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>1.0</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>COMPATIBILITY</span> <span style=color:#e6db74>AnyNewerVersion</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>install(<span style=color:#e6db74>FILES</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;${CMAKE_CURRENT_BINARY_DIR}/mylibConfigVersion.cmake&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>DESTINATION</span> <span style=color:#e6db74>lib/cmake/mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=2><li>安装</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -DCMAKE_INSTALL_PREFIX<span style=color:#f92672>=</span>/usr/local ..
</span></span><span style=display:flex><span>make install
</span></span></code></pre></div><p>目录结构</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/local/
</span></span><span style=display:flex><span>  ├── include/
</span></span><span style=display:flex><span>  │     └── foo.h
</span></span><span style=display:flex><span>  ├── lib/
</span></span><span style=display:flex><span>  │     ├── libmylib.a
</span></span><span style=display:flex><span>  │     └── cmake/mylib/
</span></span><span style=display:flex><span>  │           ├── mylibTargets.cmake
</span></span><span style=display:flex><span>  │           ├── mylibConfig.cmake
</span></span><span style=display:flex><span>  │           └── mylibConfigVersion.cmake
</span></span></code></pre></div><ol start=3><li>在另一个项目中使用</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>find_package(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>REQUIRED</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_executable(<span style=color:#e6db74>app</span> <span style=color:#e6db74>main.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>MyLib::mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=现代cmake理念>现代CMake理念</h2><p>CMake的我发展经历了一个从“命令式”到“声明式”的转变，这就是所谓的现代CMake理念</p><h3 id=传统cmake旧写法>传统CMake（旧写法）</h3><p>早期的CMake写法往往是命令式、全局变量驱动的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e># 旧写法
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>include_directories</span>(<span style=color:#960050;background-color:#1e0010>$</span>{CMAKE_SOURCE_DIR}<span style=color:#f92672>/</span>include)
</span></span><span style=display:flex><span><span style=color:#a6e22e>link_directories</span>(<span style=color:#960050;background-color:#1e0010>$</span>{CMAKE_SOURCE_DIR}<span style=color:#f92672>/</span>lib)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add_executable</span>(app main.cpp)
</span></span><span style=display:flex><span><span style=color:#a6e22e>target_link_libraries</span>(app mylib)
</span></span></code></pre></div><p>缺点：</p><ul><li>全局污染：<code>include_directories()</code>和<code>link_directories()</code>影响所有目标，依赖关系不清晰</li><li>难以维护：大型项目里，谁依赖了什么一目不明</li><li>模块化差：库的使用方式不清晰，别人引入时需要手动写一堆include和link</li></ul><h3 id=现代cmake推荐写法>现代CMake（推荐写法）</h3><p>现代CMake强调目标导向（Target-based）、声明式、可复用性<br>核心理念就是：所有的编译信息都绑定在target上，而不是全局设置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_library(<span style=color:#e6db74>mylib</span> <span style=color:#e6db74>src/mylib.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 指定库的头文件（公开接口）
</span></span></span><span style=display:flex><span>target_include_directories(<span style=color:#e6db74>mylib</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>include</span> <span style=color:#75715e># 使用该库的人也需要的头文件
</span></span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>src/internal</span> <span style=color:#75715e># 仅库内部需要
</span></span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 指定库依赖
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>mylib</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>otherlib</span> <span style=color:#75715e># 链接依赖传播出去
</span></span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>pthread</span> <span style=color:#75715e># 内部使用，外部不需要关心
</span></span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_executable(<span style=color:#e6db74>app</span> <span style=color:#e6db74>main.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>mylib</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>这样</p><ul><li><code>app</code>使用<code>mylib</code>时，会自动继承它的<code>include</code>和<code>otherlib</code>，不用手动重复</li><li>依赖关系清晰：谁需要传播、谁仅内部使用一目了然</li></ul><h3 id=现代cmake核心理念>现代CMake核心理念</h3><ol><li>目标导向（Target-base）</li></ol><ul><li>一切都围绕target（库、可执行文件）来写</li><li>避免使用全局指令，如<code>include_directories()</code>、<code>link_directories()</code>，改用<code>target_*()</code></li></ul><ol start=2><li>作用域清晰（PUBLIC/PRIVATE/INTERFACE）</li></ol><ul><li>PRIVATE：仅自己使用</li><li>PUBLIC：自己和依赖者都使用</li><li>INTERFACE：只有依赖者使用，自己不用</li></ul><ol start=3><li>导出与安装</li></ol><ul><li>库能被别人用，就要写<code>install()</code>和<code>export()</code></li><li>使用Config Package 模式导出（<code>MyLibConfig.cmake</code>），而不是<code>FindXXX.cmake</code></li></ul><ol start=4><li>声明式而非命令式</li></ol><ul><li>旧CMake：一步步告诉CMake做什么</li><li>新CMake：声明依赖关系，CMake自己推导构建流程</li></ul><ol start=5><li>跨平台与工具链</li></ol><ul><li>不写死编译器参数，使用<code>target_compile_features()</code>、<code>target_compile_options()</code></li><li>让CMake根据编译器/平台自动决定</li></ul><p>现代CMake优点</p><ul><li>可维护性高：大型工程更易管理</li><li>依赖自动传播：别人用你的库，不用重复配置</li><li>跨平台性强：声明式语法让项目更容易迁移</li><li>兼容包管理：容易与<code>vcpkg</code>、<code>Conan</code>等工具集成</li></ul><h4 id=target_api>target_*API</h4><ol><li><code>target_link_libraries</code>
声明某个目标依赖哪些库，并指定作用域</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>myApp</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>myLibA</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>myLibB</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>INTERFACE</span> <span style=color:#e6db74>myLibC</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>PRIVATE：只在<code>myApp</code>内生效，不传播给依赖它的目标</li><li>PUBLIC：在<code>myApp</code>内生效，同时传播给依赖<code>myAPP</code>的目标</li><li>INTERFACE：不在<code>myApp</code>内生效，只传播给依赖它的目标</li></ul><ol start=2><li><code>target_include_directories</code>
给目标添加头文件路径：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_include_directories(<span style=color:#e6db74>myLib</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>include/</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>src/</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>INTERFACE</span> <span style=color:#e6db74>api/</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=3><li><code>target_compile_definitions</code>
给目标添加预处理宏</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_compile_definitions(<span style=color:#e6db74>myApp</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>DEBUG_MODE</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>USE_LIBX</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=4><li><code>target_compile_options</code>
给目标添加编译器选项</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_compile_options(<span style=color:#e6db74>myApp</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>-Wall</span> <span style=color:#e6db74>-Wextra</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=5><li><code>target_sources</code>
直接声明目标的源文件（比<code>add_executable</code>/<code>add_library</code>更灵活）</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_sources(<span style=color:#e6db74>myLib</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>src/foo.cpp</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>include/foo.h</span>
</span></span><span style=display:flex><span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=6><li><code>target_compile_features</code>
声明目标需要的C++标准</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>target_compile_feature(<span style=color:#e6db74>myApp</span> <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>cxx_std_17</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>比`set(CMAKE_CXX_STANDARD 17)更推荐</p><p><strong>target API的传播机制</strong></p><ul><li>依赖树会自动继承编译信息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_library(<span style=color:#e6db74>libA</span> <span style=color:#e6db74>...</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_compile_definitions(<span style=color:#e6db74>libA</span> <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>USE_A</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_executable(<span style=color:#e6db74>app</span> <span style=color:#e6db74>main.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_link_libraries(<span style=color:#e6db74>app</span> <span style=color:#e6db74>PRIVATE</span> <span style=color:#e6db74>libA</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><code>app</code>会自动拥有<code>USE_A</code>宏</p><h2 id=示例>示例</h2><ol><li>假设有一个最简单的C++项目</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>project-root</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#f92672>CMakeLists</span>.<span style=color:#a6e22e>txt</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#f92672>main</span>.<span style=color:#a6e22e>cpp</span>
</span></span></code></pre></div><p>main.cpp</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e># include &lt;iostream&gt;
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hello, CMake!&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>CMakeLists.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minium_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.10</span>) <span style=color:#75715e># 要求的最低CMake版本
</span></span></span><span style=display:flex><span>project(<span style=color:#e6db74>HelloCMake</span>) <span style=color:#75715e># 项目名称
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_CXX_STANDARD</span> <span style=color:#e6db74>17</span>) <span style=color:#75715e># 设置C++标准
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_executable(<span style=color:#e6db74>hello</span> <span style=color:#e6db74>main.cpp</span>) <span style=color:#75715e># 生成可执行文件
</span></span></span></code></pre></div><p>构建：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir build <span style=color:#f92672>&amp;&amp;</span> cd build
</span></span><span style=display:flex><span>cmake ..
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>./hello
</span></span></code></pre></div><ol start=2><li>稍微复杂的项目
目录结构：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>project-root</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#f92672>CMakeLists</span>.<span style=color:#a6e22e>txt</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#f92672>src</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>     <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#f92672>CMakeLists</span>.<span style=color:#a6e22e>txt</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>     <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#f92672>main</span>.<span style=color:#a6e22e>cpp</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>     <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#f92672>foo</span>.<span style=color:#a6e22e>cpp</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#f92672>include</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#f92672>foo</span>.<span style=color:#a6e22e>h</span>
</span></span></code></pre></div><p><code>project-root/CMakeLists.txt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minium_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.10</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>project(<span style=color:#e6db74>MyProject</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>set(<span style=color:#e6db74>CMAKE_CXX_STANDARD</span> <span style=color:#e6db74>17</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>add_subdirectory(<span style=color:#e6db74>src</span>) <span style=color:#75715e># 进入scr/目录继续处理
</span></span></span></code></pre></div><p><code>scr/CMakeLists.txt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmake data-lang=cmake><span style=display:flex><span>add_executable(<span style=color:#e6db74>myapp</span> <span style=color:#e6db74>main.cpp</span> <span style=color:#e6db74>foo.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>target_include_directories(<span style=color:#e6db74>myapp</span> <span style=color:#e6db74>PUBLIC</span> <span style=color:#e6db74>../include</span>) <span style=color:#75715e># 指定头文件目录
</span></span></span></code></pre></div><p>这样目录更清晰，适合大型项目</p></div><nav class=post-nav><a href=/unixlike/lib/clone/ class=hover:underline>pre: clone</a>
<a href=/unixlike/lib/commit/ class=hover:underline>next: commit</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><ul><li><a href=#cmake基本工作流程>CMake基本工作流程</a></li><li><a href=#cmake语法>CMake语法</a><ul><li><a href=#基本特点>基本特点</a></li><li><a href=#变量>变量</a></li><li><a href=#控制语句>控制语句</a></li><li><a href=#函数与宏>函数与宏</a></li><li><a href=#列表操作>列表操作</a></li><li><a href=#字符串操作>字符串操作</a></li><li><a href=#文件与路径>文件与路径</a></li><li><a href=#数学与逻辑>数学与逻辑</a></li><li><a href=#构建命令>构建命令</a></li><li><a href=#target属性现代cmake推荐>target属性（现代CMake推荐）</a></li><li><a href=#模块与包>模块与包</a></li><li><a href=#子目录与安装>子目录与安装</a></li><li><a href=#工具>工具</a></li><li><a href=#cmake特有命令>CMake特有命令</a></li></ul></li><li><a href=#cmake功能>CMake功能</a><ul><li><a href=#debugrelease>Debug/Release</a><ul><li><a href=#设置方式>设置方式</a></li><li><a href=#cmake内部变量>CMake内部变量</a></li><li><a href=#在cmakeliststxt中使用>在CMakeLists.txt中使用</a></li></ul></li><li><a href=#跨平台工具链>跨平台工具链</a><ul><li><a href=#指定工具链文件>指定工具链文件</a></li><li><a href=#工具链文件的内容>工具链文件的内容</a></li><li><a href=#现代cmake更推荐的做法>现代CMake更推荐的做法</a></li></ul></li><li><a href=#安装与导出>安装与导出</a><ul><li><a href=#安装install>安装（install）</a></li><li><a href=#导出export>导出（export）</a></li><li><a href=#完整工作流>完整工作流</a></li></ul></li></ul></li><li><a href=#现代cmake理念>现代CMake理念</a><ul><li><a href=#传统cmake旧写法>传统CMake（旧写法）</a></li><li><a href=#现代cmake推荐写法>现代CMake（推荐写法）</a></li><li><a href=#现代cmake核心理念>现代CMake核心理念</a><ul><li><a href=#target_api>target_*API</a></li></ul></li></ul></li><li><a href=#示例>示例</a></li></ul></li></ul></nav></aside><script src=/js/scrollspy.js defer></script><script type=module>
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ 
    startOnLoad: true, theme: "default" });
</script><footer><div class=container><p>© 2026 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSES.md>Full License</a></p></div></footer></body></html>