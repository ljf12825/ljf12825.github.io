---
title: "Hot Update"
layout: single
date: 2025-06-01
categories: [笔记]
tags: [Unity, Hot Update]
author: "ljf12825"
permalink: /posts/2025-08-02-Hot-Update/
---
热更新指的是在游戏运行后，不需要重写打包和分发客户端，就能更新或修复代码、资源的机制\
简单理解：
- 不热更：出了bug -> 改代码 -> 重新打包 -> 玩家重新下载安装
- 热更：除了bug -> 改代码 -> 发布更新包 -> 玩家下小补丁，立即生效

为什么要用热更新
- 移动端、主机端游戏包体大、审核严格，频繁发新包代价极高
- 上线后bug修复：能第一时间止血
- 内容更新：节省分发成本（活动、新关卡、皮肤）
- 快速迭代：尤其是手游和运营类游戏


## Unity热更新常见方式
### 资源热更新
主要解决美术资源、配置文件更新问题\
实现思路：
- 把资源（Prefab/Texture/音效等）打成AssetBundle
- 游戏运行时从服务器下载最新AssetBundle -> 替换旧资源
- 配合资源版本管理（Manifest + Hash）

特点：
- 实现简单
- Unity官方支持
- 只能更新资源，不能更新逻辑代码

### 代码热更新
核心：C#脚本的运行时代码替换\
UnityC#脚本编译后会生成IL（中间语言），运行时通过Mono或IL2CPP执行\
要想热更，需要解决如何加载/执行新代码

常见方案：
1. 反射/动态加载DLL
  - 用Mono编译器在外部生成新的DLL
  - 游戏运行时加载（Assembly.Load）
  - 可以调用新逻辑，但有局限性

缺点：
  - IL2CPP平台不支持直接动态加载DLL（比如iOS）

2. ILRuntime（国内常用）
  - 一个开源的IL解释器
  - 运行时用解释执行外部编译的DLL
  - 解决了IL2CPP的限制，可以在iOS/Android都用

特点：
  - 跨平台
  - 活跃社区，国内大厂常用（比如热更新游戏项目）
  - 心梗你比原生IL差（解释执行）

3. HybridCLR（近几年兴起）
  - 思路是补全Unity剪掉的AOT元数据，让运行时能加载新的IL
  - 结合热更DLL + 补充元数据，实现近似原生的性能

特点：
  - 性能接近原生
  - 无需解释器，能跑在IL2CPP上
  - 实现复杂，生态还在发展

4. Lua/JS脚本热更
  - 用Lua、JS等脚本语言写游戏逻辑
  - Unity只负责运行时环境
  - 热更就是替换脚本文件

特点：
  - 逻辑热更灵活
  - 不依赖C#
  - 开发效率、IDE支持差，团队要适应

## 混合方案
- 资源用AssetBundle更新
- 逻辑用HybridCLR/ILRuntime/Lua热更
- 配置数据用JSON/CSV/ScriptableObject更新

## 热更的关键技术点
1. 版本管理
  - 需要有版本号、校验Hash、对比差异的机制

2. 更新流程
  - 检查更新 -> 下载资源/DLL -> 校验 -> 替换

3. 安全性
  - 防止恶意替换，通常用签名验证、加密

4. 灰度发布
  - 分批投放，避免更新导致全服崩溃

