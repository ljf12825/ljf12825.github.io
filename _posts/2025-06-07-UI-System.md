---
title: "UI System"
layout: single
date: 2025-06-01
categories: [笔记]
tags: [Unity, Unity System, Render]
author: "ljf12825"
permalink: /posts/2025-06-07-UI-System/
---
Unity UI系统是Unity引擎内置的用于构建用户界面的工具集。它基于Canvas（画布）架构，支持制作按钮、文本、图片、滑动条、输入框等各种交互元素

## UGUI和NGUI

| 特性     | UGUI（Unity GUI）                        | NGUI（Next-Gen UI）             |
| ------ | -------------------------------------- | ----------------------------- |
| 开发方    | Unity 官方                               | 第三方（Tasharen Entertainment）   |
| 引入版本   | Unity 4.6+ 内置                          | Unity 3.x 时期的主流 UI 插件         |
| 集成性    | 原生集成，支持 Canvas、EventSystem、Animation 等 | 插件形式，较早期版本需手动集成               |
| 渲染系统   | 使用 Unity 内部渲染系统（Canvas）                | 自定义渲染系统，Draw Call 优化依赖面板拆分    |
| 编辑器支持  | 所见即所得，Scene View 拖拽 UI                 | 早期需要反复预览，后期版本改善较多             |
| 多分辨率适配 | 有自动布局系统、Anchor、RectTransform           | 依赖自定义 Anchor 系统               |
| 动画支持   | 支持 Unity Animation 和 Animator          | 原生支持有限，需自定义组件                 |
| 事件系统   | 支持原生 EventSystem（点击、拖拽等）               | 使用自己的事件系统                     |
| 社区和文档  | 官方支持，Unity 文档齐全                        | 社区活跃度下降，文档依赖作者和社区             |
| 性能     | 对大型复杂 UI 会产生较多 Draw Call，需要合批优化        | 更早期对 Draw Call 优化做得较极致，但维护成本高 |
| 是否推荐使用 |  推荐（Unity 官方支持）                       |  不推荐新项目使用（已过时）               |

NGUI是在Unity官方UI系统还不成熟时的“事实标准”，很多Unity3.x和4.x的项目大量使用  
UGUI时Unity官方退出的新UI系统，功能更强大，易于扩展，且原生支持多平台和工具链   

![CreateUI](/assets/images/CreateUI.jpg/)

## Canvas
Canvas是Unity中所有UI元素的容器，所有UI控件都必须是Canvas的子对象，否则它们不会被渲染成UI


![CanvasInspector](/assets/images/CanvasInspector.jpg/)

### Canvas的渲染模式
Canvas有三种渲染模式，不同模式影响UI的显示方式、渲染顺序以及与摄像机的关系

#### 1.Screen Space - Overlay（屏幕空间覆盖）
- 这是默认模式
- UI直接渲染在屏幕上，始终覆盖在游戏视图的最上层
- 不受任何摄像机影响，不需要摄像机参与渲染
- 适合制作固定在屏幕上的HUD、血条、菜单等
- 优点：渲染简单，效率高
- 缺点：无法与3D世界产生深度关系，UI始终在前面

#### 2.Screen Space - Camera（屏幕空间摄像机）
- UI挂载在指定的摄像机前面
- 通过摄像机来渲染UI，UI会与摄像机的视锥和深度产生关系
- 允许UI元素首摄像机影响（缩放、视角变化）
- 常用于需要与摄像机视角联动的UI，例如放大镜效果、视角内提示等
- 可以控制UI的排序顺序（Sorting Layer和Order in Layer）

#### 3.World Space（世界空间）
- UI作为3D场景中的普通物体存在
- 有自己的位置、旋转、缩放，可以放在场景中任意位置
- 通过普通摄像机渲染，能与3D模型、光照等交互
- 适合制作3D菜单、游戏内面板、悬浮信息
- 需要调整Canvas的大小和UI元素的尺寸，比较复杂

### Canvas组件的重要属性
#### Screen Space - Overlay
![CanvasScreenSpace-Overlay](/assets/images/Canvas-ScreenSpace-Overlay.jpg/)

默认模式  

- Render Mode：渲染模式，见上文
- Pixel Perfect：像素完美，开启后UI元素会对齐到像素点，减少模糊，适合2D像素风UI
- Sort Order：控制UI元素渲染顺序，决定了多个Canvas之间的渲染优先级，数值越大，渲染层级越靠前，会覆盖数值较小的Canvas；数值相同，会根据它们在Hierarchy中的位置决定前后
- Target Display：该Canvas渲染到哪一个物理显示器上，这个功能主要用在多显示器应用中，默认Unity只是用主显示器（Display1），有八个可选项，必须在代码中手动启动多个显示器 `if (Dispaly.display.Length > 1) Display.display[1].Activate();`（启用Display 2）
- Additional Shader Channels：用于指定UI顶点需要传递给Shader的额外数据通道
  当你使用自定义UI Shader（比如为按钮添加特效、动画、描边等）时，可能需要从UI元素的每个顶点传递一些额外数据（如颜色、UV1、法线、Tangent等）到Shader中。而默认Canvas并不会传递这些数据，只有你在`Additional Shader Channels`中显式勾选，Unity才会将这些数据从CPU传给GPU
  可选项说明：
    - TexCoord1：第二套UV坐标，一些Shader特效可能使用
    - TexCoord2：第三套UV坐标
    - TexCoord3：第四套UV坐标
    - Normal：法线信息（常用于光照Shader）
    - Tangent：切线信息（常与法线贴图配合）
    - Color：颜色通道（通常UI默认传递的是主颜色）

    Unity的UI是通过`CanvasRenderer`生成的顶点数据送入GPU，默认只传position、uv0、color；若Shader需要额外通道，必须通过`Additional Shader Channels`显式开启，让`Canvas`包装完整数据；但需要注意，勾选越多，传输数据越大，性能开销越大（尤其是在移动端）

- Vertex Color Always In Gamma Color Space：控制UI顶点颜色是否始终使用Gamma空间进行处理，无论当前项目是否使用Linear或Gamma颜色空间

#### Screen Space - Camera
![CanvasScreenSpace-Camera](/assets/images/Canvas-ScreenSpace-Camera.jpg/)

#### World Space
![CanvasWorldSpace](/assets/images/Canvas-WorldSpace.jpg/)

### Canvas Scaler

### Graphic Raycaster


## UI Componenet

## Layout System

## Event System

## UI动画

## UI资源管理

## UI动态生成

## UI Manager System

## UI性能优化




