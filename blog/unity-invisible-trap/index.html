<!doctype html><html lang=en><head><meta charset=UTF-8><title>Unity Invisible Trap</title><link rel=stylesheet href=/css/style.css><link href=https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/prismjs@1/prism.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-csharp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-cpp.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-text.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-ini.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-c.min.js></script><link rel=stylesheet href=/css/blogsingle.css></head><body><header><title>How to Develop a Game</title><div class=container><img src=/images/gamelife.jpg alt="Unity Invisible Trap" class=banner></div></header><nav class=topnav><div class=container><ul><li><a href=/>Home</a></li><li><a href=/article/>Article</a></li><li><a href=/blog/>Blog</a></li><li><a href=/projects/>Projects</a></li><li><a href=/tool/>Tool & Resource</a></li><li><a href=/reference/>Reference</a></li><li><a href=/about/>About</a></li></ul></div></nav><article class=single_article><div class=title>Unity Invisible Trap<div class=meta>PublishDate: 2025-06-01 |
CreateDate: 2025-06-01 |
LastModify: 2025-06-01
| Creator：ljf12825</div></div><div class=content><p>Unity实际开发中，有很多“看起来正常、实则容易出错”的<strong>奇怪问题</strong>（或称为<strong>隐形陷阱</strong>）</p><h1 id=quick-list>Quick List</h1><h2 id=class1-交互相关>Class1 交互相关</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td><a href=#1%E5%A4%9A%E4%B8%AA%E5%8F%AF%E4%BA%A4%E4%BA%92%E7%89%A9%E4%BD%93%E8%BE%93%E5%85%A5%E8%A7%A6%E5%8F%91%E5%A4%9A%E4%B8%AA>按下交互键时多个箱子同时打开</a></td><td>范围内存在多个交互体，未判断距离</td><td>使用 <code>OverlapSphere</code> + 计算最近距离</td><td>输入、交互</td></tr><tr><td>鼠标点击物体无反应</td><td>被 UI 或透明物体挡住，Raycast 被拦截</td><td>检查 UI 的 Raycast Target 设置</td><td>输入、射线</td></tr><tr><td>射线打不中目标</td><td>射线层级错误或未设置 LayerMask</td><td>使用正确 Layer 和 LayerMask</td><td>输入、射线</td></tr><tr><td>玩家进入 Trigger 区域被触发两次</td><td>存在多个 Collider 重叠，重复触发</td><td>判断 <code>other.gameObject</code> 是否重复</td><td>触发器、碰撞</td></tr></tbody></table><h2 id=class2-动画控制>Class2 动画控制</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td><code>SetTrigger</code> 后动画无反应</td><td>没有关闭 <code>Has Exit Time</code> 或过渡设置错误</td><td>调整 Animator Transition 设置</td><td>动画、状态机</td></tr><tr><td>动画状态切换卡顿</td><td>切换时未等待上一状态结束</td><td>使用 CrossFade，设置合理 transition duration</td><td>动画</td></tr><tr><td>动画参数更新后立即调用 <code>Play</code> 无效</td><td>Animator 状态未刷新</td><td>等待一帧或避免立即 <code>Play</code></td><td>动画、代码时序</td></tr><tr><td>动画过渡后恢复原始状态</td><td>未使用 <code>Animator.ResetTrigger</code></td><td>设置状态触发后重置 Trigger</td><td>动画、状态机</td></tr></tbody></table><h2 id=class3-ui系统>Class3 UI系统</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td>UI 按钮点击无效</td><td>被其他透明 UI 挡住</td><td>检查 Canvas 层级，关闭遮挡物的 Raycast Target</td><td>UI、输入</td></tr><tr><td>Text 性能差、频繁 GC</td><td>使用 <code>Text</code> 频繁更新</td><td>使用 <code>TextMeshPro</code> + 对象池</td><td>UI、性能</td></tr><tr><td>UI 点击穿透到底部物体</td><td>未正确使用 <code>CanvasGroup.blocksRaycasts</code></td><td>设置为 false 阻止穿透</td><td>UI、射线</td></tr><tr><td>ScrollView 滚动方向错乱</td><td>锚点、Pivot 设置错误</td><td>调整 Content 和 Viewport 的锚点</td><td>UI、布局</td></tr></tbody></table><h2 id=class4-物理系统>Class4 物理系统</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td>移动物体穿过墙体</td><td>使用了 <code>transform.position</code> 移动刚体</td><td>改用 <code>Rigidbody.MovePosition()</code></td><td>物理、穿透</td></tr><tr><td>刚体滑动不自然</td><td>没有设置 Drag、Mass 等属性</td><td>设置合理的阻力与摩擦系数</td><td>物理</td></tr><tr><td>触发器触发失效</td><td>Collider 未勾选 isTrigger，或 Rigidbody 缺失</td><td>确保至少一方含 Rigidbody 且 Collider 是触发器</td><td>物理、触发器</td></tr></tbody></table><h2 id=class5-资源加载与管理>Class5 资源加载与管理</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td>Resources.Load 的资源未释放</td><td>Destroy 了物体但资源仍驻留内存</td><td>调用 <code>Resources.UnloadUnusedAssets()</code></td><td>内存、加载</td></tr><tr><td>Addressables 资源释放失败</td><td>未调用 <code>Release()</code></td><td>每次加载后使用 <code>Addressables.Release(handle)</code></td><td>Addressables</td></tr><tr><td>AudioClip 提前中断</td><td>多个 AudioSource 播放相同 Clip 被覆盖</td><td>用 <code>PlayOneShot</code> 或动态创建 AudioSource</td><td>音频、资源</td></tr></tbody></table><h2 id=class6-生命周期与协程>Class6 生命周期与协程</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td><code>WaitForSeconds()</code> 在暂停时不起作用</td><td>依赖 <code>Time.timeScale</code>，暂停后为 0</td><td>使用 <code>WaitForSecondsRealtime()</code></td><td>协程、暂停</td></tr><tr><td>Update 在隐藏物体时仍执行</td><td>脚本和 GameObject 仍处于 enabled 状态</td><td>手动控制 <code>enabled = false</code></td><td>生命周期</td></tr><tr><td>OnDisable 未被调用</td><td>GameObject 被销毁不是禁用</td><td>区分 <code>Destroy</code> 与 <code>SetActive(false)</code></td><td>生命周期、事件</td></tr></tbody></table><h2 id=class7-性能优化相关>Class7 性能优化相关</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td>场景切换时卡顿</td><td>同步加载资源或过多 Awake 初始化</td><td>用 <code>LoadSceneAsync</code>，资源异步预加载</td><td>性能、加载</td></tr><tr><td>Update() 性能开销大</td><td>多个脚本使用 Update，逻辑分散</td><td>使用事件驱动 + 管理器合并 Update</td><td>性能、架构</td></tr><tr><td>GC Alloc 频繁</td><td>每帧创建新对象（如字符串、new Vector3）</td><td>复用变量、使用对象池</td><td>性能、GC</td></tr></tbody></table><h2 id=class8-编译器-vs-构建行为差异>Class8 编译器 vs 构建行为差异</h2><table><thead><tr><th>现象</th><th>原因</th><th>解决方式</th><th>标签</th></tr></thead><tbody><tr><td>编辑器正常，打包后报错</td><td>使用了 <code>UnityEditor</code> API</td><td>用 <code>#if UNITY_EDITOR</code> 包裹</td><td>构建、平台差异</td></tr><tr><td>场景中未勾选物体在运行时出现</td><td>被代码运行时 Instantiate</td><td>确认代码逻辑未动态生成</td><td>构建、场景管理</td></tr><tr><td>路径访问失败</td><td>各平台 <code>persistentDataPath</code> 不一致</td><td>使用平台判断封装路径</td><td>IO、平台兼容</td></tr></tbody></table><h1 id=class1-交互相关-1>Class1 交互相关</h1><h2 id=1多个可交互物体输入触发多个>1.多个可交互物体，输入触发多个</h2><ul><li>场景：靠近多个箱子同时按下<code>E</code>，多个箱子一起打开</li><li>原因：所有物体监听<code>E</code>，没有加距离或唯一判定</li><li>解决方案：只响应最近/朝向前方的一个对象</li></ul><h2 id=2trigger触发多次enterexit>2.Trigger触发多次Enter/Exit</h2><ul><li>场景：一个对象靠近某个Trigger区域，<code>OnTriggerEnter</code>被触发两次</li><li>原因：<ul><li>可能身上挂有多个Collider</li><li>或包含子物体的Collider也触发了</li></ul></li><li>解决方案：确认是否是重复触发，加入<code>other.gameObject == expectedObject</code>判断</li></ul><h2 id=3button-ui点击两次才响应>3.Button UI点击两次才响应</h2><ul><li>原因：<ul><li>UI按钮背后有透明/未关闭的UI元素挡住射线</li><li>或者EventSystem被禁用、Canvas未设置正确Sorting Order</li></ul></li><li>解决方案：调试Graphic Raycaster、Canvas排序、Raycast Target勾选项</li></ul><h1 id=class2-物理系统相关>Class2 物理系统相关</h1><h2 id=1rigidbody设置position导致穿透>1.Rigidbody设置position导致穿透</h2><ul><li>使用<code>transform.position = ...</code>设置刚体位置，会跳过物理引擎检测，导致穿墙</li><li>正确做法：使用<code>Rigidbody.MovePosition()</code></li></ul><h2 id=2collider和rigidbody的组合错误>2.Collider和Rigidbody的组合错误</h2><ul><li><p>常见错误组合</p><ul><li>静态物体（如地面）用了非Kinematic的Rigidbody</li><li>移动物体没加Rigidbody，靠transform移动导致物理行为异常</li></ul></li><li><p>Unity的推荐：</p><ul><li>静态物体（地面）用Collider，无Rigidbody</li><li>动态物体加Rigidbody，控制用物理接口</li></ul></li></ul><h1 id=class3-生命周期相关>Class3 生命周期相关</h1><h2 id=1协程中的waitforseconds在timescale为0时失效>1.协程中的<code>WaitForSeconds</code>在TimeScale为0时失效</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>StartCoroutine(Example());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>IEnumerator Example()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>yield</span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> WaitForSeconds(<span style=color:#ae81ff>2f</span>); <span style=color:#75715e>// 如果Time.timeScale == 0，不会等待</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>解决方案：用`WaitForSecondRealtime(2f);</li></ul><h2 id=2脚本的update仍被调用虽然物体不可见>2.脚本的<code>Update()</code>仍被调用，虽然物体不可见</h2><ul><li>即使物体在摄像机外、隐藏或inactive子物体，只要GameObject时active的、脚本时enable的，Update就会继续执行</li></ul><h1 id=class4-动画系统相关>Class4 动画系统相关</h1><h2 id=1animator动画不能立即切换>1.Animator动画不能立即切换</h2><ul><li>使用<code>SetTrigger</code>后动画没反应，原因是当前状态没有达到可以跳转的条件或冷却没完成</li><li>解决方案：Animator控制器中正确配置Transition，并关闭<code>Has Exit Time</code>（除非需要完整播放）</li></ul><h2 id=2animator状态机切换卡顿或不触发>2.Animator状态机切换卡顿或不触发</h2><ul><li>在代码里调用了：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>animator.SetBool(<span style=color:#e6db74>&#34;isOpen&#34;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>animator.Play(<span style=color:#e6db74>&#34;Open&#34;</span>);
</span></span></code></pre></div><ul><li>原因：设置参数后马上<code>Play</code>，但Unity还没更新Animator的状态，应延迟一帧或合并状态逻辑</li></ul><h1 id=class5-资源加载与内存相关>Class5 资源加载与内存相关</h1><h2 id=1addressables或resourcesload的资源加载了但没释放>1.Addressables或Resources.Load的资源加载了但没释放</h2><ul><li>开发中用完资源后<code>Destroy(obj)</code>了，却发现内存依然飙高</li><li>原因：Unity对部分资源（如Texture、Mesh）会做缓存，要手动调用<code>Resources.UnloadUnusedAssets()</code>或<code>Addressables.Release(handle)</code></li></ul><h2 id=2audioclip播放一半没声音或提前中断>2.AudioClip播放一半没声音或提前中断</h2><ul><li>多个<code>AudioSource</code>播放相同Clip时，其中一个会抢断另一个</li><li>使用<code>PlayOneShot()</code>或实例化新的AudioSource</li></ul><h1 id=class6-编译器运行与构建差异>Class6 编译器运行与构建差异</h1><h2 id=1在editor模式下一切正常打包后就崩溃>1.在Editor模式下一切正常，打包后就崩溃</h2><ul><li>原因：用了<code>AssetDatabase</code>、<code>EditorUtility</code>、<code>UnityEditor</code>命名空间代码</li><li>加<code>#if UNITY_EDITOR</code>包裹相关逻辑</li></ul><h2 id=2场景中物体没勾选但运行中出现了>2.场景中物体没勾选但运行中出现了</h2><ul><li>某些Prefab被脚本<code>Instantiate()</code>出来了，但在场景中没看到</li><li>检查脚本逻辑力是否有运行时代码加载或启动对象</li></ul></div><nav class=post-nav><a href=/blog/unity-game-development-optimization/ class=hover:underline>pre: Unity Game Development Optimization</a>
<a href=/blog/unity-memory-and-performance-management/ class=hover:underline>next: Unity Memory and Performance Management</a></nav></article><aside class=toc><h3>TOC</h3><nav id=TableOfContents><ul><li><a href=#quick-list>Quick List</a><ul><li><a href=#class1-交互相关>Class1 交互相关</a></li><li><a href=#class2-动画控制>Class2 动画控制</a></li><li><a href=#class3-ui系统>Class3 UI系统</a></li><li><a href=#class4-物理系统>Class4 物理系统</a></li><li><a href=#class5-资源加载与管理>Class5 资源加载与管理</a></li><li><a href=#class6-生命周期与协程>Class6 生命周期与协程</a></li><li><a href=#class7-性能优化相关>Class7 性能优化相关</a></li><li><a href=#class8-编译器-vs-构建行为差异>Class8 编译器 vs 构建行为差异</a></li></ul></li><li><a href=#class1-交互相关-1>Class1 交互相关</a><ul><li><a href=#1多个可交互物体输入触发多个>1.多个可交互物体，输入触发多个</a></li><li><a href=#2trigger触发多次enterexit>2.Trigger触发多次Enter/Exit</a></li><li><a href=#3button-ui点击两次才响应>3.Button UI点击两次才响应</a></li></ul></li><li><a href=#class2-物理系统相关>Class2 物理系统相关</a><ul><li><a href=#1rigidbody设置position导致穿透>1.Rigidbody设置position导致穿透</a></li><li><a href=#2collider和rigidbody的组合错误>2.Collider和Rigidbody的组合错误</a></li></ul></li><li><a href=#class3-生命周期相关>Class3 生命周期相关</a><ul><li><a href=#1协程中的waitforseconds在timescale为0时失效>1.协程中的<code>WaitForSeconds</code>在TimeScale为0时失效</a></li><li><a href=#2脚本的update仍被调用虽然物体不可见>2.脚本的<code>Update()</code>仍被调用，虽然物体不可见</a></li></ul></li><li><a href=#class4-动画系统相关>Class4 动画系统相关</a><ul><li><a href=#1animator动画不能立即切换>1.Animator动画不能立即切换</a></li><li><a href=#2animator状态机切换卡顿或不触发>2.Animator状态机切换卡顿或不触发</a></li></ul></li><li><a href=#class5-资源加载与内存相关>Class5 资源加载与内存相关</a><ul><li><a href=#1addressables或resourcesload的资源加载了但没释放>1.Addressables或Resources.Load的资源加载了但没释放</a></li><li><a href=#2audioclip播放一半没声音或提前中断>2.AudioClip播放一半没声音或提前中断</a></li></ul></li><li><a href=#class6-编译器运行与构建差异>Class6 编译器运行与构建差异</a><ul><li><a href=#1在editor模式下一切正常打包后就崩溃>1.在Editor模式下一切正常，打包后就崩溃</a></li><li><a href=#2场景中物体没勾选但运行中出现了>2.场景中物体没勾选但运行中出现了</a></li></ul></li></ul></nav></aside><script>document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelectorAll(".single_article h1, .single_article h2, .single_article h3, .single_article h4, .single_article h5, .single_article h6"),e=document.querySelectorAll(".toc a");let t=!1;e.forEach(n=>{n.addEventListener("click",s=>{e.forEach(e=>e.classList.remove("active")),n.classList.add("active"),t=!0,setTimeout(()=>{t=!1},800)})});const s=new IntersectionObserver(n=>{if(t)return;n.forEach(t=>{if(t.isIntersecting){let n=t.target.getAttribute("id");e.forEach(e=>{e.classList.toggle("active",e.getAttribute("href")==="#"+n)})}})},{rootMargin:"-20% 0px -70% 0px",threshold:0});n.forEach(e=>s.observe(e))})</script><footer><div class=container><p>© 2025 Jeff Lee(ljf12825). All rights reserved |
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Article: CC BY-NC-SA 4.0</a> |
<a href=https://creativecommons.org/licenses/by-sa/4.0/>Content: CC BY-SA 4.0</a> |
<a href=https://opensource.org/licenses/MIT>Code: MIT License</a> |
<a href=/LICENSE.md>Full License</a></p></div></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('a[href^="http"]').forEach(e=>{e.setAttribute("target","_blank")})})</script></body></html>